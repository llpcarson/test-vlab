<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>Radiation Scheme in CCPP: grrad.f Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Radiation Scheme in CCPP
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('grrad_8f_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">grrad.f</div>  </div>
</div><!--header-->
<div class="contents">
<a href="grrad_8f.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">! ==========================================================  !!!!!</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">!             &#39;module_radiation_driver&#39; descriptions           !!!!!</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">!  ==========================================================  !!!!!</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">!   this is the radiation driver module.  it prepares atmospheric      !</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">!   profiles and invokes main radiation calculations.                  !</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">!   in module &#39;module_radiation_driver&#39; there are twe externally       !</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">!   callable subroutine:                                               !</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">!      &#39;radinit&#39;    -- initialization routine                          !</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">!         input:                                                       !</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment">!           ( si, NLAY, me )                                           !</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">!         output:                                                      !</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment">!           ( none )                                                   !</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">!      &#39;radupdate&#39;  -- update time sensitive data used by radiations   !</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">!         input:                                                       !</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">!           ( idate,jdate,deltsw,deltim,lsswr, me )                    !</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">!         output:                                                      !</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">!           ( slag,sdec,cdec,solcon )                                  !</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">!      &#39;grrad&#39;      -- setup and invoke main radiation calls           !</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">!         input:                                                       !</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">!          ( prsi,prsl,prslk,tgrs,qgrs,tracer,vvl,slmsk,               !</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">!            xlon,xlat,tsfc,snowd,sncovr,snoalb,zorl,hprim,            !</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">!            alvsf,alnsf,alvwf,alnwf,facsf,facwf,fice,tisfc,           !</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">!            sinlat,coslat,solhr,jdate,solcon,                         !</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">!            cv,cvt,cvb,fcice,frain,rrime,flgmin,                      !</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">!            icsdsw,icsdlw, ntcw,ncld,ntoz, NTRAC,NFXR,                !</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">!            dtlw,dtsw, lsswr,lslwr,lssav,                             !</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">!            IX, IM, LM, me, lprnt, ipt, kdt,deltaq,sup,cnvw,cnvc,     !</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">!         output:                                                      !</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">!            htrsw,topfsw,sfcfsw,dswcmp,uswcmp,sfalb,coszen,coszdg,    !</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">!            htrlw,topflw,sfcflw,tsflw,semis,cldcov,                   !</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">!         input/output:                                                !</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">!            fluxr                                                     !</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="comment">!         optional output:                                             !</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">!            htrlw0,htrsw0,htrswb,htrlwb                               !</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">!   external modules referenced:                                       !</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">!       &#39;module physparam&#39;                  in &#39;physparam.f&#39;           !</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">!       &#39;module funcphys&#39;                   in &#39;funcphys.f&#39;            !</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="comment">!       &#39;module physcons&#39;                   in &#39;physcons.f&#39;            !</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">!       &#39;module module_radiation_gases&#39;     in &#39;radiation_gases.f&#39;     !</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">!       &#39;module module_radiation_aerosols&#39;  in &#39;radiation_aerosols.f&#39;  !</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">!       &#39;module module_radiation_surface&#39;   in &#39;radiation_surface.f&#39;   !</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">!       &#39;module module_radiation_clouds&#39;    in &#39;radiation_clouds.f&#39;    !</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">!       &#39;module module_radsw_cntr_para&#39;     in &#39;radsw_xxxx_param.f&#39;    !</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">!       &#39;module module_radsw_parameters&#39;    in &#39;radsw_xxxx_param.f&#39;    !</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">!       &#39;module module_radsw_main&#39;          in &#39;radsw_xxxx_main.f&#39;     !</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">!       &#39;module module_radlw_cntr_para&#39;     in &#39;radlw_xxxx_param.f&#39;    !</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">!       &#39;module module_radlw_parameters&#39;    in &#39;radlw_xxxx_param.f&#39;    !</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">!       &#39;module module_radlw_main&#39;          in &#39;radlw_xxxx_main.f&#39;     !</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">!    where xxxx may vary according to different scheme selection       !</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">!   program history log:                                               !</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">!     mm-dd-yy    ncep         - created program grrad                 !</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">!     08-12-03    yu-tai hou   - re-written for modulized radiations   !</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">!     11-06-03    yu-tai hou   - modified                              !</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">!     01-18-05    s. moorthi   - NOAH/ICE model changes added          !</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">!     05-10-05    yu-tai hou   - modified module structure             !</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">!     12-xx-05    s. moorthi   - sfc lw flux adj by mean temperature   !</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">!     02-20-06    yu-tai hou   - add time variation for co2 data, and  !</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">!                                solar const. add sfc emiss change     !</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">!     03-21-06    s. Moorthi   - added surface temp over ice           !</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">!     07-28-06    yu-tai hou   - add stratospheric vocanic aerosols    !</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">!     03-14-07    yu-tai hou   - add generalized spectral band interp  !</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">!                                for aerosol optical prop. (sw and lw) !</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">!     04-10-07    yu-tai hou   - spectral band sw/lw heating rates     !</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="comment">!     05-04-07    yu-tai hou   - make options for clim based and modis !</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">!                                based (h. wei and c. marshall) albedo !</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">!     09-05-08    yu-tai hou   - add the initial date and time &#39;idate&#39; !</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">!                    and control param &#39;ICTM&#39; to the passing param list!</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">!                    to handel different time/date requirements for    !</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">!                    external data (co2, aeros, solcon, ...)           !</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">!     10-10-08    yu-tai hou   - add the ICTM=-2 option for combining  !</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment">!                    initial condition data with seasonal cycle from   !</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment">!                    climatology.                                      !</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">!     03-12-09    yu-tai hou   - use two time stamps to keep tracking  !</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">!                    dates for init cond and fcst time. remove volcanic!</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">!                    aerosols data in climate hindcast (ICTM=-2).      !</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">!     03-16-09    yu-tai hou   - included sub-column clouds approx.    !</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">!                    control flags isubcsw/isubclw in initialization   !</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">!                    subroutine. passed auxiliary cloud control arrays !</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">!                    icsdsw/icsdlw (if isubcsw/isubclw =2, it will be  !</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">!                    the user provided permutation seeds) to the sw/lw !</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">!                    radiation calculation programs. also moved cloud  !</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">!                    overlapping control flags iovrsw/iovrlw from main !</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">!                    radiation routines to the initialization routines.!</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">!     04-02-09    yu-tai hou   - modified surface control flag iems to !</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">!                    have additional function of if the surface-air    !</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">!                    interface have the same or different temperature  !</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="comment">!                    for radiation calculations.                       !</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment">!     04-03-09    yu-tai hou   - modified to add lw surface emissivity !</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">!                    as output variable. changed the sign of sfcnsw to !</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">!                    be positive value denote solar flux goes into the !</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">!                    ground (this is needed to reduce sign confusion   !</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">!                    in other part of model)                           !</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">!     09-09-09    fanglin yang (thru s.moorthi) added QME5 QME6 to E-20!</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">!     01-09-10    sarah lu     - added gocart option, revised grrad for!</span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">!                    gocart coupling. calling argument modifed: ldiag3 !</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">!                    removed; cldcov/fluxr sequence changed; cldcov is !</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">!                    changed from accumulative to instant field and    !</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">!                    from input/output to output field                 !</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">!     01-24-10    sarah lu     - added aod to fluxr, added prslk and   !</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">!                    oz to setaer input argument (for gocart coupling),!</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">!                    added tau_gocart to setaer output argument (for,  !</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">!                    aerosol diag by index of nv_aod)                  !</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">!     07-08-10    s.moorthi - updated the NEMS version for new physics !</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">!     07-28-10    yu-tai hou   - changed grrad interface to allow all  !</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">!                    components of sw/lw toa/sfc instantaneous values  !</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">!                    being passed to the calling program. moved the    !</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">!                    computaion of sfc net sw flux (sfcnsw) to the     !</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">!                    calling program. merged carlos&#39; nmmb modification.!</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">!     07-30-10    s. moorthi - corrected some errors associated with   !</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">!                    unit changes                                      !</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">!     12-02-10    s. moorthi/y. hou - removed the use of aerosol flags !</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">!                    &#39;iaersw&#39; &#39;iaerlw&#39; from radiations and replaced    !</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">!                    them by using the runtime variable laswflg and    !</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">!                    lalwflg defined in module radiation_aerosols.     !</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">!                    also replaced param nspc in grrad with the use of !</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">!                    max_num_gridcomp in module radiation_aerosols.    !</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">!     jun 2012    yu-tai hou   - added sea/land madk &#39;slmsk&#39; to the    !</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">!                    argument list of subrotine setaer call for the    !</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">!                    newly modified horizontal bi-linear interpolation !</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">!                    in climatological aerosols schem. also moved the  !</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">!                    virtual temperature calculations in subroutines   !</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">!                    &#39;radiation_clouds&#39; and &#39;radiation_aerosols&#39; to    !</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">!                    &#39;grrad&#39; to reduce repeat comps. renamed var oz as !</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment">!                    tracer to reflect that it carries various prog    !</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">!                    tracer quantities.                                !</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">!                              - modified to add 4 compontents of sw   !</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">!                    surface downward fluxes to the output. (vis/nir;  !</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">!                    direct/diffused). re-arranged part of the fluxr   !</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">!                    variable fields and filled the unused slots for   !</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">!                    the new components.  added check print of select  !</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">!                    data (co2 value for now).                         !</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">!                              - changed the initialization subrution  !</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">!                    &#39;radinit&#39; into two parts: &#39;radinit&#39; is called at  !</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment">!                    the start of model run to set up radiation related!</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">!                    fixed parameters; and &#39;radupdate&#39; is called in    !</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">!                    the time-loop to update time-varying data sets    !</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">!                    and module variables.                             !</span></div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">!     sep 2012    h-m lin/y-t hou added option of extra top layer for  !</span></div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">!                    models with low toa ceiling. the extra layer will !</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">!                    help ozone absorption at higher altitude.         !</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">!     nov 2012    yu-tai hou   - modified control parameters through   !</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">!                    module &#39;physparam&#39;.                                !</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">!     jan 2013    yu-tai hou   - updated subr radupdate for including  !</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">!                    options of annual/monthly solar constant table.   !</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">!     mar 2013    h-m lin/y-t hou corrected a bug in extra top layer   !</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">!                    when using ferrier microphysics.                  !</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">!     may 2013    s. mooorthi - removed fpkapx                         !</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">!     jul 2013    r. sun - added pdf cld and convective cloud water and!</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">!                          cover for radiation                         !</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">!     aug 2013    s. moorthi  - port from gfs to nems                  !</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">!     13Feb2014   sarah lu - add aerodp to fluxr                       !</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment">!     Apr 2014    Xingren Wu - add sfc SW downward fluxes nir/vis and  !</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment">!                    sfcalb to export for A/O/I coupling               !</span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">!     jun 2014    y-t hou    - revised code to include surface up and  !</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">!                    down spectral components sw fluxes as output.     !</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">!                                                                      !</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">!!!!!  ==========================================================  !!!!!</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">!!!!!                       end descriptions                       !!!!!</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">!!!!!  ==========================================================  !!!!!</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">!========================================!</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="namespacemodule__radiation__driver.html">  184</a></span>&#160;      <span class="keyword">module</span> <a class="code" href="namespacemodule__radiation__driver.html">module_radiation_driver</a> <span class="comment">!</span></div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">!........................................!</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacephysparam.html">physparam</a></div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacephyscons.html">physcons</a><span class="keywordtype">,                 only</span> : eps   =&gt; <a class="code" href="namespacephyscons.html#a25c0b5ef7ed84a574bf7e215ddaee65d">con_eps</a>,            &amp;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;     &amp;                                     epsm1 =&gt; <a class="code" href="namespacephyscons.html#a2ca326d6f385fb0100c05ed44b20c345">con_epsm1</a>,          &amp;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;     &amp;                                     fvirt =&gt; <a class="code" href="namespacephyscons.html#ad200a2d8149c61dbdd05124ce977a928">con_fvirt</a>           &amp;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;     &amp;,                                    rocp  =&gt; <a class="code" href="namespacephyscons.html#a72b27573c69ec418b67763d35b3688a1">con_rocp</a></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;      <span class="keywordtype">use </span>funcphys<span class="keywordtype">,                 only</span> : fpvs</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radiation__astronomy.html">module_radiation_astronomy</a><span class="keywordtype">,only</span>: <a class="code" href="namespacemodule__radiation__astronomy.html#a00825c1a13e09455c478efa11314cb2d">sol_init</a>, <a class="code" href="namespacemodule__radiation__astronomy.html#a7c3585f7355925b360f5bc5d2c25c09e">sol_update</a>, <a class="code" href="namespacemodule__radiation__astronomy.html#a8ce5ecf0524d0460baf6c467b532085c">coszmn</a></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radiation__gases.html">module_radiation_gases</a><span class="keywordtype">,   only</span> : <a class="code" href="namespacemodule__radiation__gases.html#affc350828412da77ff3cf3e617ddc66c">nf_vgas</a>, <a class="code" href="namespacemodule__radiation__gases.html#ad06401a54d361b3dd852d815d1b0f71e">getgases</a>, <a class="code" href="namespacemodule__radiation__gases.html#af4be311f1ec1601a167655c1632d66de">getozn</a>,   &amp;</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;     &amp;                                     <a class="code" href="namespacemodule__radiation__gases.html#a1def261c0ef5d5408658c87b6dc08b53">gas_init</a>, <a class="code" href="namespacemodule__radiation__gases.html#a064db1c287e8614ae7efd6b4fac91a6b">gas_update</a></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radiation__aerosols.html">module_radiation_aerosols</a><span class="keywordtype">,only</span> : <a class="code" href="namespacemodule__radiation__aerosols.html#ae0d9615fa694e2a5dfe8fb48e99b7e76">nf_aesw</a>, <a class="code" href="namespacemodule__radiation__aerosols.html#afba0069cd611248a9595a126a13f5203">nf_aelw</a>, <a class="code" href="namespacemodule__radiation__aerosols.html#a94a9a162f822d2ee5c5bff611403dd06">setaer</a>,    &amp;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;     &amp;                                     <a class="code" href="namespacemodule__radiation__aerosols.html#a6086afe5183a09ca64810af7fe2a12ac">aer_init</a>, <a class="code" href="namespacemodule__radiation__aerosols.html#a2a91dba33725576c80b4b0f556031707">aer_update</a>,        &amp;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;     &amp;                                     <a class="code" href="namespacemodule__radiation__aerosols.html#a476c0181513603112dec3f4d2a2ec839">nspc1</a>                       </div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radiation__surface.html">module_radiation_surface</a><span class="keywordtype">, only</span> : <a class="code" href="namespacemodule__radiation__surface.html#ab7800982c900bd632ca74d5e7d2b5ab3">nf_albd</a>, <a class="code" href="namespacemodule__radiation__surface.html#acb6f94d91110828e4c117e3ba0b279a5">sfc_init</a>, <a class="code" href="namespacemodule__radiation__surface.html#a79d2feaf2f32435b179ef7bc86ad3f36">setalb</a>,   &amp;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;     &amp;                                     <a class="code" href="namespacemodule__radiation__surface.html#a0fdd0e9a9c536d3d41bd6b6c9d0a8675">setemis</a></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radiation__clouds.html">module_radiation_clouds</a><span class="keywordtype">,  only</span> : <a class="code" href="namespacemodule__radiation__clouds.html#a66cf0f94619a3d865b0c593197a30576">nf_clds</a>, <a class="code" href="namespacemodule__radiation__clouds.html#ab6fef8945e0a409b2e0968b414ba5573">cld_init</a>,           &amp;</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;     &amp;                                     <a class="code" href="namespacemodule__radiation__clouds.html#ab45374e1eeec7d6211284b38c3ec8448">progcld1</a>, <a class="code" href="namespacemodule__radiation__clouds.html#a2f45f48505bb69a968c788ff680b5642">progcld2</a>, <a class="code" href="namespacemodule__radiation__clouds.html#a1953118ed22c3b6f8d94ef231b47a08b">progcld3</a>,&amp;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;     &amp;                                     <a class="code" href="namespacemodule__radiation__clouds.html#ab477be986b08fe827c44dbe352a23d39">diagcld1</a></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__parameters.html">module_radsw_parameters</a><span class="keywordtype">,  only</span> : <a class="code" href="namespacemodule__radsw__parameters.html#structmodule__radsw__parameters_1_1topfsw__type">topfsw_type</a>, <a class="code" href="namespacemodule__radsw__parameters.html#structmodule__radsw__parameters_1_1sfcfsw__type">sfcfsw_type</a>,    &amp;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;     &amp;                                     <a class="code" href="namespacemodule__radsw__parameters.html#structmodule__radsw__parameters_1_1profsw__type">profsw_type</a>,<a class="code" href="namespacemodule__radsw__parameters.html#structmodule__radsw__parameters_1_1cmpfsw__type">cmpfsw_type</a>,<a class="code" href="namespacemodule__radsw__parameters.html#ab1e121fde29dde00871e4a7d43be1ddb">nbdsw</a></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radsw__main.html">module_radsw_main</a><span class="keywordtype">,        only</span> : <a class="code" href="namespacemodule__radsw__main.html#afab73c508f778203d0f4b5181f1cbca9">rswinit</a>,  <a class="code" href="namespacemodule__radsw__main.html#ad9b28f997232642658b4d15a7eb70fcd">swrad</a></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__parameters.html">module_radlw_parameters</a><span class="keywordtype">,  only</span> : <a class="code" href="namespacemodule__radlw__parameters.html#structmodule__radlw__parameters_1_1topflw__type">topflw_type</a>, <a class="code" href="namespacemodule__radlw__parameters.html#structmodule__radlw__parameters_1_1sfcflw__type">sfcflw_type</a>,    &amp;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;     &amp;                                     <a class="code" href="namespacemodule__radlw__parameters.html#structmodule__radlw__parameters_1_1proflw__type">proflw_type</a>, <a class="code" href="namespacemodule__radlw__parameters.html#a39a115a97296886b2e6e37b220e942c7">nbdlw</a></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordtype">use </span><a class="code" href="namespacemodule__radlw__main.html">module_radlw_main</a><span class="keywordtype">,        only</span> : <a class="code" href="namespacemodule__radlw__main.html#ad1f036ae760a7e9dcbbdd93492617bb3">rlwinit</a>,  <a class="code" href="namespacemodule__radlw__main.html#a072a355f2067d729d64d2997270e36b1">lwrad</a></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="keywordtype">implicit   none</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;      <span class="keywordtype">private</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">!  ---  version tag and last revision date</span></div><div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="namespacemodule__radiation__driver.html#a70a36595385cf1f5794f9c5859e52ab6">  219</a></span>&#160;      <span class="keywordtype">character(40)</span>, <span class="keywordtype">parameter</span> ::                                       &amp;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;     &amp;   VTAGRAD=<span class="stringliteral">&#39;NCEP-Radiation_driver    v5.2  Jan 2013 &#39;</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment">!    &amp;   VTAGRAD=&#39;NCEP-Radiation_driver    v5.1  Nov 2012 &#39;</span></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment">!    &amp;   VTAGRAD=&#39;NCEP-Radiation_driver    v5.0  Aug 2012 &#39;</span></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">!  ---  constant values</span></div><div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="namespacemodule__radiation__driver.html#afdc2a7e1dbfb075ac33a2388564d9428">  225</a></span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: <a class="code" href="namespacemodule__radiation__driver.html#afdc2a7e1dbfb075ac33a2388564d9428">qmin</a>, <a class="code" href="namespacemodule__radiation__driver.html#ab671cb80142c71dab5f41f01ccdcc088">qme5</a>, <a class="code" href="namespacemodule__radiation__driver.html#a4916e37c472b2f824b6f566ff67200cd">qme6</a>, <a class="code" href="namespacemodule__radiation__driver.html#a0b0bf0fa8723b80d0891ec3327d187d7">epsq</a></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">!     parameter (QMIN=1.0e-10, QME5=1.0e-5,  QME6=1.0e-6,  EPSQ=1.0e-12)</span></div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      parameter(<a class="code" href="namespacemodule__radiation__driver.html#afdc2a7e1dbfb075ac33a2388564d9428">qmin</a>=1.0e-10, <a class="code" href="namespacemodule__radiation__driver.html#ab671cb80142c71dab5f41f01ccdcc088">qme5</a>=1.0e-7,  <a class="code" href="namespacemodule__radiation__driver.html#a4916e37c472b2f824b6f566ff67200cd">qme6</a>=1.0e-7,  <a class="code" href="namespacemodule__radiation__driver.html#a0b0bf0fa8723b80d0891ec3327d187d7">epsq</a>=1.0e-12)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">!     parameter (QMIN=1.0e-10, QME5=1.0e-20, QME6=1.0e-20, EPSQ=1.0e-12)</span></div><div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="namespacemodule__radiation__driver.html#a3fc43ca0d2c5f69a380ddb4f0926ecc7">  229</a></span>&#160;      <span class="keywordtype">real</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="namespacemodule__radiation__driver.html#a3fc43ca0d2c5f69a380ddb4f0926ecc7">prsmin</a> = 1.0e-6 <span class="comment">! toa pressure minimum value in mb (hpa)</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">!  ---  control flags set in subr radinit:</span></div><div class="line"><a name="l00232"></a><span class="lineno"><a class="line" href="namespacemodule__radiation__driver.html#a9ee6a89464bf206cc07ea30d7eeaaeb8">  232</a></span>&#160;      <span class="keywordtype">integer</span> :: <a class="code" href="namespacemodule__radiation__driver.html#a9ee6a89464bf206cc07ea30d7eeaaeb8">itsfc</a>  =0            <span class="comment">! flag for lw sfc air/ground interface temp setting</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">!  ---  data input control variables set in subr radupdate:</span></div><div class="line"><a name="l00235"></a><span class="lineno"><a class="line" href="namespacemodule__radiation__driver.html#ac4baf8ff048aaa5b85d03cc42c579c7b">  235</a></span>&#160;      <span class="keywordtype">integer</span> :: <a class="code" href="namespacemodule__radiation__driver.html#a6eb268f296c77047f389ed6fac5f95be">month0</a>=0,   <a class="code" href="namespacemodule__radiation__driver.html#a4d755de48d0aa83f337a2a907ac7d8a2">iyear0</a>=0,   <a class="code" href="namespacemodule__radiation__driver.html#ac4baf8ff048aaa5b85d03cc42c579c7b">monthd</a>=0</div><div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="namespacemodule__radiation__driver.html#af6e0e1ef2ebb78f57c897ebaf633edd2">  236</a></span>&#160;      <span class="keywordtype">logical</span> :: <a class="code" href="namespacemodule__radiation__driver.html#af6e0e1ef2ebb78f57c897ebaf633edd2">loz1st</a> =.true.       <span class="comment">! first-time clim ozone data read flag</span></div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="comment">!  ---  optional extra top layer on top of low ceiling models</span></div><div class="line"><a name="l00239"></a><span class="lineno"><a class="line" href="namespacemodule__radiation__driver.html#aab2535e9906afd709124056f4ca1e470">  239</a></span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="namespacemodule__radiation__driver.html#aab2535e9906afd709124056f4ca1e470">ltp</a> = 0   <span class="comment">! no extra top layer</span></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="comment">!     integer, parameter :: LTP = 1   ! add an extra top layer</span></div><div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="namespacemodule__radiation__driver.html#ad27b36d0186c8147fe839eb5c268d157">  241</a></span>&#160;      <span class="keywordtype">logical</span>, <span class="keywordtype">parameter</span> :: <a class="code" href="namespacemodule__radiation__driver.html#ad27b36d0186c8147fe839eb5c268d157">lextop</a> = (<a class="code" href="namespacemodule__radiation__driver.html#aab2535e9906afd709124056f4ca1e470">ltp</a> &gt; 0)</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<span class="comment">!  ---  publicly accessible module programs:</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;      <span class="keywordtype">public</span> <a class="code" href="namespacemodule__radiation__driver.html#af039e0c23dc6ab8d2f8b1c1c796ac0da">radinit</a>, <a class="code" href="namespacemodule__radiation__driver.html#a47f0e4defe607fbfc751f6c9274f459a">radupdate</a>, <a class="code" href="namespacemodule__radiation__driver.html#a8285cf6a4d2e1ed25b0afff8e269ec63">grrad</a></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">! =================</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;      <span class="keyword">contains</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">! =================</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="namespacemodule__radiation__driver.html#af039e0c23dc6ab8d2f8b1c1c796ac0da">radinit</a>                                                &amp;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l00261"></a><span class="lineno"><a class="line" href="namespacemodule__radiation__driver.html#af039e0c23dc6ab8d2f8b1c1c796ac0da">  261</a></span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;     &amp;     ( si, nlay, me )</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">!          ( none )</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment">! =================   subprogram documentation block   ================ !</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">! subprogram:   radinit     initialization of radiation calculations    !</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="comment">! usage:        call radinit                                            !</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="comment">! attributes:                                                           !</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="comment">!   language:  fortran 90                                               !</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment">!   machine:   wcoss                                                   !</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="comment">!  ====================  definition of variables  ====================  !</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="comment">! input parameters:                                                     !</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">!   si               : model vertical sigma interface                   !</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="comment">!   NLAY             : number of model vertical layers                  !</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">!   me               : print control flag                               !</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">!  outputs: (none)                                                      !</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">!  external module variables:  (in module physparam)                     !</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;<span class="comment">!   isolar   : solar constant cntrol flag                               !</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">!              = 0: use the old fixed solar constant in &quot;physcon&quot;       !</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">!              =10: use the new fixed solar constant in &quot;physcon&quot;       !</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">!              = 1: use noaa ann-mean tsi tbl abs-scale with cycle apprx!</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;<span class="comment">!              = 2: use noaa ann-mean tsi tbl tim-scale with cycle apprx!</span></div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">!              = 3: use cmip5 ann-mean tsi tbl tim-scale with cycl apprx!</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="comment">!              = 4: use cmip5 mon-mean tsi tbl tim-scale with cycl apprx!</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">!   iaerflg  : 3-digit aerosol flag (abc for volc, lw, sw)              !</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">!              a:=0 use background stratospheric aerosol                !</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">!                =1 include stratospheric vocanic aeros                 !</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">!              b:=0 no topospheric aerosol in lw radiation              !</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="comment">!                =1 compute tropspheric aero in 1 broad band for lw     !</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment">!                =2 compute tropspheric aero in multi bands for lw      !</span></div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">!              c:=0 no topospheric aerosol in sw radiation              !</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="comment">!                =1 include tropspheric aerosols for sw                 !</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;<span class="comment">!   ico2flg  : co2 data source control flag                             !</span></div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="comment">!              =0: use prescribed global mean co2 (old  oper)           !</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="comment">!              =1: use observed co2 annual mean value only              !</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">!              =2: use obs co2 monthly data with 2-d variation          !</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">!   ictmflg  : =yyyy#, external data ic time/date control flag          !</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">!              =   -2: same as 0, but superimpose seasonal cycle        !</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">!                      from climatology data set.                       !</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">!              =   -1: use user provided external data for the          !</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">!                      forecast time, no extrapolation.                 !</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">!              =    0: use data at initial cond time, if not            !</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment">!                      available, use latest, no extrapolation.         !</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment">!              =    1: use data at the forecast time, if not            !</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment">!                      available, use latest and extrapolation.         !</span></div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">!              =yyyy0: use yyyy data for the forecast time,             !</span></div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">!                      no further data extrapolation.                   !</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment">!              =yyyy1: use yyyy data for the fcst. if needed, do        !</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment">!                      extrapolation to match the fcst time.            !</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment">!   ioznflg  : ozone data source control flag                           !</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">!              =0: use climatological ozone profile                     !</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">!              =1: use interactive ozone profile                        !</span></div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">!   ialbflg  : albedo scheme control flag                               !</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">!              =0: climatology, based on surface veg types              !</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">!              =1: modis retrieval based surface albedo scheme          !</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">!   iemsflg  : emissivity scheme cntrl flag (ab 2-digit integer)        !</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">!              a:=0 set sfc air/ground t same for lw radiation          !</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">!                =1 set sfc air/ground t diff for lw radiation          !</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">!              b:=0 use fixed sfc emissivity=1.0 (black-body)           !</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">!                =1 use varying climtology sfc emiss (veg based)        !</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">!                =2 future development (not yet)                        !</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">!   icldflg  : cloud optical property scheme control flag               !</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">!              =0: use diagnostic cloud scheme                          !</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment">!              =1: use prognostic cloud scheme (default)                !</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">!   icmphys  : cloud microphysics scheme control flag                   !</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="comment">!              =1 zhao/carr/sundqvist microphysics scheme               !</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="comment">!              =2 brad ferrier microphysics scheme                      !</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment">!              =3 zhao/carr/sundqvist microphysics+pdf cloud &amp; cnvc,cnvw!</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="comment">!   iovrsw   : control flag for cloud overlap in sw radiation           !</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">!   iovrlw   : control flag for cloud overlap in lw radiation           !</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">!              =0: random overlapping clouds                            !</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">!              =1: max/ran overlapping clouds                           !</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">!   isubcsw  : sub-column cloud approx control flag in sw radiation     !</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">!   isubclw  : sub-column cloud approx control flag in lw radiation     !</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">!              =0: with out sub-column cloud approximation              !</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">!              =1: mcica sub-col approx. prescribed random seed         !</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">!              =2: mcica sub-col approx. provided random seed           !</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="comment">!   lsashal  : shallow convection scheme flag                           !</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;<span class="comment">!   lcrick   : control flag for eliminating CRICK                       !</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="comment">!              =t: apply layer smoothing to eliminate CRICK             !</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment">!              =f: do not apply layer smoothing                         !</span></div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">!   lcnorm   : control flag for in-cld condensate                       !</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">!              =t: normalize cloud condensate                           !</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">!              =f: not normalize cloud condensate                       !</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">!   lnoprec  : precip effect in radiation flag (ferrier microphysics)   !</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">!              =t: snow/rain has no impact on radiation                 !</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">!              =f: snow/rain has impact on radiation                    !</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">!   ivflip   : vertical index direction control flag                    !</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="comment">!              =0: index from toa to surface                            !</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="comment">!              =1: index from surface to toa                            !</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="comment">!  subroutines called: sol_init, aer_init, gas_init, cld_init,          !</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="comment">!                      sfc_init, rlwinit, rswinit                       !</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment">!  usage:       call radinit                                            !</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">!  ===================================================================  !</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;      <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: NLAY, me</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(in)</span> :: si(:)</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="comment">!  ---  outputs: (none, to module variables)</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">!  ---  set up control variables</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;      <a class="code" href="namespacemodule__radiation__driver.html#a9ee6a89464bf206cc07ea30d7eeaaeb8">itsfc</a>  = <a class="code" href="namespacephysparam.html#ac0ecfb79a533c6acab25971a3d871ea2">iemsflg</a> / 10             <span class="comment">! sfc air/ground temp control</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      <a class="code" href="namespacemodule__radiation__driver.html#af6e0e1ef2ebb78f57c897ebaf633edd2">loz1st</a> = (<a class="code" href="namespacephysparam.html#a90d63a1a0c04479f586ce21df72d36b7">ioznflg</a> == 0)           <span class="comment">! first-time clim ozone data read flag</span></div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;      <a class="code" href="namespacemodule__radiation__driver.html#a6eb268f296c77047f389ed6fac5f95be">month0</a> = 0</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;      <a class="code" href="namespacemodule__radiation__driver.html#a4d755de48d0aa83f337a2a907ac7d8a2">iyear0</a> = 0</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      <a class="code" href="namespacemodule__radiation__driver.html#ac4baf8ff048aaa5b85d03cc42c579c7b">monthd</a> = 0</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;      <span class="keywordflow">if</span> (me == 0) <span class="keywordflow">then</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="comment">!       print *,&#39; NEW RADIATION PROGRAM STRUCTURES -- SEP 01 2004&#39;</span></div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        print *,<span class="stringliteral">&#39; NEW RADIATION PROGRAM STRUCTURES BECAME OPER. &#39;</span>,      &amp;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;     &amp;          <span class="stringliteral">&#39;  May 01 2007&#39;</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        print *, <a class="code" href="namespacemodule__radiation__driver.html#a70a36595385cf1f5794f9c5859e52ab6">vtagrad</a>                <span class="comment">!print out version tag</span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        print *,<span class="stringliteral">&#39; - Selected Control Flag settings: ICTMflg=&#39;</span>,<a class="code" href="namespacephysparam.html#a4eef5ac5e5b83526d5da7de493cfe73d">ictmflg</a>,  &amp;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;     &amp;    <span class="stringliteral">&#39; ISOLar =&#39;</span>,<a class="code" href="namespacephysparam.html#adf09a9ec1939f1ee47bb4190a9098941">isolar</a>, <span class="stringliteral">&#39; ICO2flg=&#39;</span>,<a class="code" href="namespacephysparam.html#a61baf693e83ac6144d86fb8213d39a79">ico2flg</a>,<span class="stringliteral">&#39; IAERflg=&#39;</span>,<a class="code" href="namespacephysparam.html#a2b30f07ca3fb04fbfff8c01eb8082e8d">iaerflg</a>,  &amp;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;     &amp;    <span class="stringliteral">&#39; IALBflg=&#39;</span>,<a class="code" href="namespacephysparam.html#aeaf899d0cbd4248ad4b7f855cb4626e1">ialbflg</a>,<span class="stringliteral">&#39; IEMSflg=&#39;</span>,<a class="code" href="namespacephysparam.html#ac0ecfb79a533c6acab25971a3d871ea2">iemsflg</a>,<span class="stringliteral">&#39; ICLDflg=&#39;</span>,<a class="code" href="namespacephysparam.html#aaba5cffa32ce34374f15cb09e21ab973">icldflg</a>,  &amp;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;     &amp;    <span class="stringliteral">&#39; ICMPHYS=&#39;</span>,<a class="code" href="namespacephysparam.html#af259ebea0c378b3b07343141977db03e">icmphys</a>,<span class="stringliteral">&#39; IOZNflg=&#39;</span>,<a class="code" href="namespacephysparam.html#a90d63a1a0c04479f586ce21df72d36b7">ioznflg</a></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        print *,<span class="stringliteral">&#39; IVFLIP=&#39;</span>,<a class="code" href="namespacephysparam.html#a7318a941744b1ec62dc9a6ff5bfbb50d">ivflip</a>,<span class="stringliteral">&#39; IOVRSW=&#39;</span>,<a class="code" href="namespacephysparam.html#a2f0c4c2c8f4a93048ab2b84826498007">iovrsw</a>,<span class="stringliteral">&#39; IOVRLW=&#39;</span>,<a class="code" href="namespacephysparam.html#a644d850cdfb6dd159e51223f715683f6">iovrlw</a>,  &amp;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;     &amp;    <span class="stringliteral">&#39; ISUBCSW=&#39;</span>,<a class="code" href="namespacephysparam.html#a2ec924900b312f94874ffb0f67d09dd9">isubcsw</a>,<span class="stringliteral">&#39; ISUBCLW=&#39;</span>,<a class="code" href="namespacephysparam.html#a9555bc46102e3c368ca1f15c73b0692e">isubclw</a></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="comment">!       write(0,*)&#39; IVFLIP=&#39;,ivflip,&#39; IOVRSW=&#39;,iovrsw,&#39; IOVRLW=&#39;,iovrlw,&amp;</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="comment">!    &amp;    &#39; ISUBCSW=&#39;,isubcsw,&#39; ISUBCLW=&#39;,isubclw</span></div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        print *,<span class="stringliteral">&#39; LSASHAL=&#39;</span>,<a class="code" href="namespacephysparam.html#abd79346fa2177075241fe6c5bc77004d">lsashal</a>,<span class="stringliteral">&#39; LCRICK=&#39;</span>,<a class="code" href="namespacephysparam.html#a3506e1f83500ea78568ab697f55cadb4">lcrick</a>,<span class="stringliteral">&#39; LCNORM=&#39;</span>,<a class="code" href="namespacephysparam.html#ae5b7bb287e8a1f935cf135ffeaadca7a">lcnorm</a>,&amp;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;     &amp;    <span class="stringliteral">&#39; LNOPREC=&#39;</span>,<a class="code" href="namespacephysparam.html#acb52e2553c9e106bd8885fd09c6e2dd2">lnoprec</a></div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        print *,<span class="stringliteral">&#39; LTP =&#39;</span>,<a class="code" href="namespacemodule__radiation__driver.html#aab2535e9906afd709124056f4ca1e470">ltp</a>,<span class="stringliteral">&#39;, add extra top layer =&#39;</span>,<a class="code" href="namespacemodule__radiation__driver.html#ad27b36d0186c8147fe839eb5c268d157">lextop</a></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="namespacephysparam.html#a4eef5ac5e5b83526d5da7de493cfe73d">ictmflg</a>==0 .or. <a class="code" href="namespacephysparam.html#a4eef5ac5e5b83526d5da7de493cfe73d">ictmflg</a>==-2 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;          print *,<span class="stringliteral">&#39;   Data usage is limited by initial condition!&#39;</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;          print *,<span class="stringliteral">&#39;   No volcanic aerosols&#39;</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="namespacephysparam.html#a9555bc46102e3c368ca1f15c73b0692e">isubclw</a> == 0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;          print *,<span class="stringliteral">&#39; - ISUBCLW=&#39;</span>,<a class="code" href="namespacephysparam.html#a9555bc46102e3c368ca1f15c73b0692e">isubclw</a>,<span class="stringliteral">&#39; No McICA, use grid &#39;</span>,         &amp;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;     &amp;            <span class="stringliteral">&#39;averaged cloud in LW radiation&#39;</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;        <span class="keywordflow">elseif</span> ( <a class="code" href="namespacephysparam.html#a9555bc46102e3c368ca1f15c73b0692e">isubclw</a> == 1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;          print *,<span class="stringliteral">&#39; - ISUBCLW=&#39;</span>,<a class="code" href="namespacephysparam.html#a9555bc46102e3c368ca1f15c73b0692e">isubclw</a>,<span class="stringliteral">&#39; Use McICA with fixed &#39;</span>,       &amp;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;     &amp;            <span class="stringliteral">&#39;permutation seeds for LW random number generator&#39;</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordflow">elseif</span> ( <a class="code" href="namespacephysparam.html#a9555bc46102e3c368ca1f15c73b0692e">isubclw</a> == 2 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;          print *,<span class="stringliteral">&#39; - ISUBCLW=&#39;</span>,<a class="code" href="namespacephysparam.html#a9555bc46102e3c368ca1f15c73b0692e">isubclw</a>,<span class="stringliteral">&#39; Use McICA with random &#39;</span>,      &amp;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;     &amp;            <span class="stringliteral">&#39;permutation seeds for LW random number generator&#39;</span></div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;          print *,<span class="stringliteral">&#39; - ERROR!!! ISUBCLW=&#39;</span>,<a class="code" href="namespacephysparam.html#a9555bc46102e3c368ca1f15c73b0692e">isubclw</a>,<span class="stringliteral">&#39; is not a &#39;</span>,          &amp;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;     &amp;            <span class="stringliteral">&#39;valid option &#39;</span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;          stop</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="namespacephysparam.html#a2ec924900b312f94874ffb0f67d09dd9">isubcsw</a> == 0 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;          print *,<span class="stringliteral">&#39; - ISUBCSW=&#39;</span>,<a class="code" href="namespacephysparam.html#a2ec924900b312f94874ffb0f67d09dd9">isubcsw</a>,<span class="stringliteral">&#39; No McICA, use grid &#39;</span>,         &amp;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;     &amp;            <span class="stringliteral">&#39;averaged cloud in SW radiation&#39;</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="keywordflow">elseif</span> ( <a class="code" href="namespacephysparam.html#a2ec924900b312f94874ffb0f67d09dd9">isubcsw</a> == 1 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;          print *,<span class="stringliteral">&#39; - ISUBCSW=&#39;</span>,<a class="code" href="namespacephysparam.html#a2ec924900b312f94874ffb0f67d09dd9">isubcsw</a>,<span class="stringliteral">&#39; Use McICA with fixed &#39;</span>,       &amp;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;     &amp;            <span class="stringliteral">&#39;permutation seeds for SW random number generator&#39;</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        <span class="keywordflow">elseif</span> ( <a class="code" href="namespacephysparam.html#a2ec924900b312f94874ffb0f67d09dd9">isubcsw</a> == 2 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;          print *,<span class="stringliteral">&#39; - ISUBCSW=&#39;</span>,<a class="code" href="namespacephysparam.html#a2ec924900b312f94874ffb0f67d09dd9">isubcsw</a>,<span class="stringliteral">&#39; Use McICA with random &#39;</span>,      &amp;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;     &amp;            <span class="stringliteral">&#39;permutation seeds for SW random number generator&#39;</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;          print *,<span class="stringliteral">&#39; - ERROR!!! ISUBCSW=&#39;</span>,<a class="code" href="namespacephysparam.html#a2ec924900b312f94874ffb0f67d09dd9">isubcsw</a>,<span class="stringliteral">&#39; is not a &#39;</span>,          &amp;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;     &amp;            <span class="stringliteral">&#39;valid option &#39;</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;          stop</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="namespacephysparam.html#a2ec924900b312f94874ffb0f67d09dd9">isubcsw</a> /= <a class="code" href="namespacephysparam.html#a9555bc46102e3c368ca1f15c73b0692e">isubclw</a> ) <span class="keywordflow">then</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;          print *,<span class="stringliteral">&#39; - *** Notice *** ISUBCSW /= ISUBCLW !!!&#39;</span>,           &amp;</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;     &amp;            <a class="code" href="namespacephysparam.html#a2ec924900b312f94874ffb0f67d09dd9">isubcsw</a>, <a class="code" href="namespacephysparam.html#a9555bc46102e3c368ca1f15c73b0692e">isubclw</a></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="comment">!     Initialization</span></div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__astronomy.html#a00825c1a13e09455c478efa11314cb2d">sol_init</a> ( me )          <span class="comment">!  --- ...  astronomy initialization routine</span></div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__aerosols.html#a6086afe5183a09ca64810af7fe2a12ac">aer_init</a> ( nlay, me )    <span class="comment">!  --- ...  aerosols initialization routine</span></div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__gases.html#a1def261c0ef5d5408658c87b6dc08b53">gas_init</a> ( me )          <span class="comment">!  --- ...  co2 and other gases initialization routine</span></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__surface.html#acb6f94d91110828e4c117e3ba0b279a5">sfc_init</a> ( me )          <span class="comment">!  --- ...  surface initialization routine</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__clouds.html#ab6fef8945e0a409b2e0968b414ba5573">cld_init</a> ( si, nlay, me) <span class="comment">!  --- ...  cloud initialization routine</span></div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemodule__radlw__main.html#ad1f036ae760a7e9dcbbdd93492617bb3">rlwinit</a> ( me )           <span class="comment">!  --- ...  lw radiation initialization routine</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemodule__radsw__main.html#afab73c508f778203d0f4b5181f1cbca9">rswinit</a> ( me )           <span class="comment">!  --- ...  sw radiation initialization routine</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="namespacemodule__radiation__driver.html#af039e0c23dc6ab8d2f8b1c1c796ac0da">radinit</a></div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="namespacemodule__radiation__driver.html#a47f0e4defe607fbfc751f6c9274f459a">radupdate</a>                                              &amp;</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l00495"></a><span class="lineno"><a class="line" href="namespacemodule__radiation__driver.html#a47f0e4defe607fbfc751f6c9274f459a">  495</a></span>&#160;</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;     &amp;     ( idate,jdate,deltsw,deltim,lsswr, me,                       &amp;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;     &amp;       slag,sdec,cdec,solcon                                      &amp;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;     &amp;     )</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="comment">! =================   subprogram documentation block   ================ !</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="comment">! subprogram:   radupdate   calls many update subroutines to check and  !</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="comment">!   update radiation required but time varying data sets and module     !</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;<span class="comment">!   variables.                                                          !</span></div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment">! usage:        call radupdate                                          !</span></div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">! attributes:                                                           !</span></div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">!   language:  fortran 90                                               !</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">!   machine:   ibm sp                                                   !</span></div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">!  ====================  definition of variables  ====================  !</span></div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">! input parameters:                                                     !</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="comment">!   idate(8)       : ncep absolute date and time of initial condition   !</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">!                    (yr, mon, day, t-zone, hr, min, sec, mil-sec)      !</span></div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">!   jdate(8)       : ncep absolute date and time at fcst time           !</span></div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">!                    (yr, mon, day, t-zone, hr, min, sec, mil-sec)      !</span></div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">!   deltsw         : sw radiation calling frequency in seconds          !</span></div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">!   deltim         : model timestep in seconds                          !</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">!   lsswr          : logical flags for sw radiation calculations        !</span></div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">!   me             : print control flag                                 !</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="comment">!  outputs:                                                             !</span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment">!   slag           : equation of time in radians                        !</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">!   sdec, cdec     : sin and cos of the solar declination angle         !</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">!   solcon         : sun-earth distance adjusted solar constant (w/m2)  !</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">!  external module variables:                                           !</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">!   isolar   : solar constant cntrl  (in module physparam)               !</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">!              = 0: use the old fixed solar constant in &quot;physcon&quot;       !</span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">!              =10: use the new fixed solar constant in &quot;physcon&quot;       !</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">!              = 1: use noaa ann-mean tsi tbl abs-scale with cycle apprx!</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="comment">!              = 2: use noaa ann-mean tsi tbl tim-scale with cycle apprx!</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="comment">!              = 3: use cmip5 ann-mean tsi tbl tim-scale with cycl apprx!</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="comment">!              = 4: use cmip5 mon-mean tsi tbl tim-scale with cycl apprx!</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">!   ictmflg  : =yyyy#, external data ic time/date control flag          !</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment">!              =   -2: same as 0, but superimpose seasonal cycle        !</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">!                      from climatology data set.                       !</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">!              =   -1: use user provided external data for the          !</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">!                      forecast time, no extrapolation.                 !</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">!              =    0: use data at initial cond time, if not            !</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment">!                      available, use latest, no extrapolation.         !</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">!              =    1: use data at the forecast time, if not            !</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">!                      available, use latest and extrapolation.         !</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">!              =yyyy0: use yyyy data for the forecast time,             !</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">!                      no further data extrapolation.                   !</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment">!              =yyyy1: use yyyy data for the fcst. if needed, do        !</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">!                      extrapolation to match the fcst time.            !</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">!  module variables:                                                    !</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">!   loz1st   : first-time clim ozone data read flag                     !</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">!  subroutines called: sol_update, aer_update, gas_update               !</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">!  ===================================================================  !</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="keywordtype">implicit none</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;      <span class="keywordtype">integer</span>, <span class="keywordtype">intent(in)</span> :: idate(:), jdate(:), me</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="keywordtype">logical</span>, <span class="keywordtype">intent(in)</span> :: lsswr</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(in)</span> :: deltsw, deltim</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(out)</span> :: slag, sdec, cdec, solcon</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">!  ---  locals:</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <span class="keywordtype">integer</span> :: iyear, imon, iday, ihour</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      <span class="keywordtype">integer</span> :: kyear, kmon, kday, khour</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="keywordtype">logical</span> :: lmon_chg       <span class="comment">! month change flag</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="keywordtype">logical</span> :: lco2_chg       <span class="comment">! cntrl flag for updating co2 data</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <span class="keywordtype">logical</span> :: lsol_chg       <span class="comment">! cntrl flag for updating solar constant</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="comment">!  --- ...  time stamp at fcst time</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;      iyear = jdate(1)</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;      imon  = jdate(2)</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;      iday  = jdate(3)</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;      ihour = jdate(5)</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">!  --- ...  set up time stamp used for green house gases (** currently co2 only)</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="namespacephysparam.html#a4eef5ac5e5b83526d5da7de493cfe73d">ictmflg</a>==0 .or. <a class="code" href="namespacephysparam.html#a4eef5ac5e5b83526d5da7de493cfe73d">ictmflg</a>==-2 ) <span class="keywordflow">then</span>  <span class="comment">! get external data at initial condition time</span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        kyear = idate(1)</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        kmon  = idate(2)</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        kday  = idate(3)</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        khour = idate(5)</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="keywordflow">else</span>                           <span class="comment">! get external data at fcst or specified time</span></div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        kyear = iyear</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        kmon  = imon</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        kday  = iday</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        khour = ihour</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="keywordflow">      endif</span>   <span class="comment">! end if_ictmflg_block</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="namespacemodule__radiation__driver.html#a6eb268f296c77047f389ed6fac5f95be">month0</a> /= imon ) <span class="keywordflow">then</span></div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        lmon_chg = .true.</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <a class="code" href="namespacemodule__radiation__driver.html#a6eb268f296c77047f389ed6fac5f95be">month0</a> = imon</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        lmon_chg = .false.</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;<span class="comment">!  --- ...  call astronomy update routine, yearly update, no time interpolation</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="keywordflow">if</span> (lsswr) <span class="keywordflow">then</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="namespacephysparam.html#adf09a9ec1939f1ee47bb4190a9098941">isolar</a> == 0 .or. <a class="code" href="namespacephysparam.html#adf09a9ec1939f1ee47bb4190a9098941">isolar</a> == 10 ) <span class="keywordflow">then</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;          lsol_chg = .false.</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;        <span class="keywordflow">elseif</span> ( <a class="code" href="namespacemodule__radiation__driver.html#a4d755de48d0aa83f337a2a907ac7d8a2">iyear0</a> /= iyear ) <span class="keywordflow">then</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;          lsol_chg = .true.</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;          lsol_chg = ( <a class="code" href="namespacephysparam.html#adf09a9ec1939f1ee47bb4190a9098941">isolar</a>==4 .and. lmon_chg )</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <a class="code" href="namespacemodule__radiation__driver.html#a4d755de48d0aa83f337a2a907ac7d8a2">iyear0</a> = iyear</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__astronomy.html#a7c3585f7355925b360f5bc5d2c25c09e">sol_update</a>                                                 &amp;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;     &amp;     ( jdate,kyear,deltsw,deltim,lsol_chg, me,                    &amp;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;     &amp;       slag,sdec,cdec,solcon                                      &amp;</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;     &amp;     )</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="keywordflow">      endif</span>  <span class="comment">! end_if_lsswr_block</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;<span class="comment">!  --- ...  call aerosols update routine, monthly update, no time interpolation</span></div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <span class="keywordflow">if</span> ( lmon_chg ) <span class="keywordflow">then</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__aerosols.html#a2a91dba33725576c80b4b0f556031707">aer_update</a> ( iyear, imon, me )</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;<span class="comment">!  --- ...  call co2 and other gases update routine</span></div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="namespacemodule__radiation__driver.html#ac4baf8ff048aaa5b85d03cc42c579c7b">monthd</a> /= kmon ) <span class="keywordflow">then</span></div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <a class="code" href="namespacemodule__radiation__driver.html#ac4baf8ff048aaa5b85d03cc42c579c7b">monthd</a> = kmon</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        lco2_chg = .true.</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        lco2_chg = .false.</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__gases.html#a064db1c287e8614ae7efd6b4fac91a6b">gas_update</a> ( kyear,kmon,kday,khour,<a class="code" href="namespacemodule__radiation__driver.html#af6e0e1ef2ebb78f57c897ebaf633edd2">loz1st</a>,lco2_chg, me )</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="namespacemodule__radiation__driver.html#af6e0e1ef2ebb78f57c897ebaf633edd2">loz1st</a> ) <a class="code" href="namespacemodule__radiation__driver.html#af6e0e1ef2ebb78f57c897ebaf633edd2">loz1st</a> = .false.</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment">!  --- ...  call surface update routine (currently not needed)</span></div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment">!     call sfc_update ( iyear, imon, me )</span></div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;<span class="comment">!  --- ...  call clouds update routine (currently not needed)</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="comment">!     call cld_update ( iyear, imon, me )</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="namespacemodule__radiation__driver.html#a47f0e4defe607fbfc751f6c9274f459a">radupdate</a></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="keyword">      subroutine </span><a class="code" href="namespacemodule__radiation__driver.html#a8285cf6a4d2e1ed25b0afff8e269ec63">grrad</a>                                                  &amp;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l00810"></a><span class="lineno"><a class="line" href="namespacemodule__radiation__driver.html#a8285cf6a4d2e1ed25b0afff8e269ec63">  810</a></span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;     &amp;     ( prsi,prsl,prslk,tgrs,qgrs,tracer,vvl,slmsk,                &amp;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;     &amp;       xlon,xlat,tsfc,snowd,sncovr,snoalb,zorl,hprim,             &amp;</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;     &amp;       alvsf,alnsf,alvwf,alnwf,facsf,facwf,fice,tisfc,            &amp;</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;     &amp;       sinlat,coslat,solhr,jdate,solcon,                          &amp;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;     &amp;       cv,cvt,cvb,fcice,frain,rrime,flgmin,                       &amp;</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;     &amp;       icsdsw,icsdlw, ntcw,ncld,ntoz, ntrac,nfxr,                 &amp;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;     &amp;       dtlw,dtsw, lsswr,lslwr,lssav, shoc_cld,                    &amp;</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;     &amp;       ix, im, lm, me, lprnt, ipt, kdt, deltaq,sup,cnvw,cnvc,     &amp;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;     &amp;       htrsw,topfsw,sfcfsw,dswcmp,uswcmp,sfalb,coszen,coszdg,     &amp;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;     &amp;       htrlw,topflw,sfcflw,tsflw,semis,cldcov,                    &amp;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;<span class="comment">!  ---  input/output:</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;     &amp;       fluxr                                                      &amp;</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;<span class="comment">!! ---  optional outputs:</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;     &amp;,      htrlw0,htrsw0,htrswb,htrlwb                                &amp;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;     &amp;     )</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="comment">! =================   subprogram documentation block   ================ !</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;<span class="comment">!    this program is the driver of radiation calculation subroutines. * !</span></div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="comment">!    It sets up profile variables for radiation input, including      * !</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">!    clouds, surface albedos, atmospheric aerosols, ozone, etc.       * !</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="comment">!                                                                     * !</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">!    usage:        call grrad                                         * !</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment">!                                                                     * !</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">!    subprograms called:                                              * !</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">!                  setalb, setemis, setaer, getozn, getgases,         * !</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">!                  progcld1, progcld2, diagcds,                       * !</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment">!                  swrad, lwrad, fpvs                                 * !</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">!                                                                     * !</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">!    attributes:                                                      * !</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">!      language:   fortran 90                                         * !</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">!      machine:    ibm-sp, sgi                                        * !</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">!                                                                     * !</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">!                                                                     * !</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">!  ====================  definition of variables  ====================  !</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="comment">!    input variables:                                                   !</span></div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="comment">!      prsi  (IX,LM+1) : model level pressure in Pa                     !</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment">!      prsl  (IX,LM)   : model layer mean pressure Pa                   !</span></div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">!      prslk (IX,LM)   : exner function = (p/p0)**rocp                  !</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">!      tgrs  (IX,LM)   : model layer mean temperature in k              !</span></div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">!      qgrs  (IX,LM)   : layer specific humidity in gm/gm               !</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">!      tracer(IX,LM,NTRAC):layer prognostic tracer amount/mixing-ratio  !</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment">!                        incl: oz, cwc, aeros, etc.                     !</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;<span class="comment">!      vvl   (IX,LM)   : layer mean vertical velocity in pa/sec         !</span></div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment">!      slmsk (IM)      : sea/land mask array (sea:0,land:1,sea-ice:2)   !</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="comment">!      xlon  (IM)      : grid longitude in radians, ok for both 0-&gt;2pi  !</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;<span class="comment">!                        or -pi -&gt; +pi ranges                           !</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;<span class="comment">!      xlat  (IM)      : grid latitude in radians, default to pi/2 -&gt;   !</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment">!                        -pi/2 range, otherwise adj in subr called      !</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment">!      tsfc  (IM)      : surface temperature in k                       !</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;<span class="comment">!      snowd (IM)      : snow depth water equivalent in mm              !</span></div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;<span class="comment">!      sncovr(IM)      : snow cover in fraction                         !</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;<span class="comment">!      snoalb(IM)      : maximum snow albedo in fraction                !</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;<span class="comment">!      zorl  (IM)      : surface roughness in cm                        !</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;<span class="comment">!      hprim (IM)      : topographic standard deviation in m            !</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;<span class="comment">!      alvsf (IM)      : mean vis albedo with strong cosz dependency    !</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;<span class="comment">!      alnsf (IM)      : mean nir albedo with strong cosz dependency    !</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment">!      alvwf (IM)      : mean vis albedo with weak cosz dependency      !</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;<span class="comment">!      alnwf (IM)      : mean nir albedo with weak cosz dependency      !</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;<span class="comment">!      facsf (IM)      : fractional coverage with strong cosz dependen  !</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment">!      facwf (IM)      : fractional coverage with weak cosz dependency  !</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment">!      fice  (IM)      : ice fraction over open water grid              !</span></div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;<span class="comment">!      tisfc (IM)      : surface temperature over ice fraction          !</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;<span class="comment">!      sinlat(IM)      : sine of the grids&#39; corresponding latitudes     !</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="comment">!      coslat(IM)      : cosine of the grids&#39; corresponding latitudes   !</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="comment">!      solhr           : hour time after 00z at the t-stepe             !</span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="comment">!      jdate (8)       : current forecast date and time                 !</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="comment">!                        (yr, mon, day, t-zone, hr, min, sec, mil-sec)  !</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;<span class="comment">!      solcon          : solar constant (sun-earth distant adjusted)    !</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;<span class="comment">!      cv    (IM)      : fraction of convective cloud                   !</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;<span class="comment">!      cvt, cvb (IM)   : convective cloud top/bottom pressure in pa     !</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;<span class="comment">!      fcice           : fraction of cloud ice  (in ferrier scheme)     !</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;<span class="comment">!      frain           : fraction of rain water (in ferrier scheme)     !</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment">!      rrime           : mass ratio of total to unrimed ice ( &gt;= 1 )    !</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="comment">!      flgmin          : minimim large ice fraction                     !</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="comment">!      icsdsw/icsdlw   : auxiliary cloud control arrays passed to main  !</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;<span class="comment">!           (IM)         radiations. if isubcsw/isubclw (input to init) !</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;<span class="comment">!                        are set to 2, the arrays contains provided     !</span></div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;<span class="comment">!                        random seeds for sub-column clouds generators  !</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;<span class="comment">!      ntcw            : =0 no cloud condensate calculated              !</span></div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;<span class="comment">!                        &gt;0 array index location for cloud condensate   !</span></div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;<span class="comment">!      ncld            : only used when ntcw .gt. 0                     !</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="comment">!      ntoz            : =0 climatological ozone profile                !</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;<span class="comment">!                        &gt;0 interactive ozone profile                   !</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;<span class="comment">!      NTRAC           : dimension veriable for array oz                !</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;<span class="comment">!      NFXR            : second dimension of input/output array fluxr   !</span></div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment">!      dtlw, dtsw      : time duration for lw/sw radiation call in sec  !</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment">!      lsswr, lslwr    : logical flags for sw/lw radiation calls        !</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;<span class="comment">!      lssav           : logical flag for store 3-d cloud field         !</span></div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;<span class="comment">!      IX,IM           : horizontal dimention and num of used points    !</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment">!      LM              : vertical layer dimension                       !</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;<span class="comment">!      me              : control flag for parallel process              !</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="comment">!      lprnt           : control flag for diagnostic print out          !</span></div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment">!      ipt             : index for diagnostic printout point            !</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment">!      kdt             : time-step number                               !</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment">!      deltaq          : half width of uniform total water distribution !</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;<span class="comment">!      sup             : supersaturation in pdf cloud when t is very low!</span></div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment">!      cnvw            : layer convective cloud water                   !</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="comment">!      cnvc            : layer convective cloud cover                   !</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;<span class="comment">!    output variables:                                                  !</span></div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;<span class="comment">!      htrsw (IX,LM)   : total sky sw heating rate in k/sec             !</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;<span class="comment">!      topfsw(IM)      : sw radiation fluxes at toa, components:        !</span></div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;<span class="comment">!                      (check module_radsw_parameters for definition)   !</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="comment">!       %upfxc           - total sky upward sw flux at toa (w/m**2)     !</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;<span class="comment">!       %dnflx           - total sky downward sw flux at toa (w/m**2)   !</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;<span class="comment">!       %upfx0           - clear sky upward sw flux at toa (w/m**2)     !</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;<span class="comment">!      sfcfsw(IM)      : sw radiation fluxes at sfc, components:        !</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;<span class="comment">!                      (check module_radsw_parameters for definition)   !</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;<span class="comment">!       %upfxc           - total sky upward sw flux at sfc (w/m**2)     !</span></div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="comment">!       %dnfxc           - total sky downward sw flux at sfc (w/m**2)   !</span></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;<span class="comment">!       %upfx0           - clear sky upward sw flux at sfc (w/m**2)     !</span></div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;<span class="comment">!       %dnfx0           - clear sky downward sw flux at sfc (w/m**2)   !</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;<span class="comment">!      dswcmp(IX,4)    : dn sfc sw spectral components:                 !</span></div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment">!       ( :, 1)          -  total sky sfc downward nir direct flux      !</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment">!       ( :, 2)          -  total sky sfc downward nir diffused flux    !</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment">!       ( :, 3)          -  total sky sfc downward uv+vis direct flux   !</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">!       ( :, 4)          -  total sky sfc downward uv+vis diff flux     !</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">!      uswcmp(IX,4)    : up sfc sw spectral components:                 !</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment">!       ( :, 1)          -  total sky sfc upward nir direct flux        !</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">!       ( :, 2)          -  total sky sfc upward nir diffused flux      !</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="comment">!       ( :, 3)          -  total sky sfc upward uv+vis direct flux     !</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment">!       ( :, 4)          -  total sky sfc upward uv+vis diff flux       !</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="comment">!      sfalb (IM)      : mean surface diffused sw albedo                !</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="comment">!      coszen(IM)      : mean cos of zenith angle over rad call period  !</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="comment">!      coszdg(IM)      : daytime mean cosz over rad call period         !</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="comment">!      htrlw (IX,LM)   : total sky lw heating rate in k/sec             !</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="comment">!      topflw(IM)      : lw radiation fluxes at top, component:         !</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="comment">!                        (check module_radlw_paramters for definition)  !</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment">!       %upfxc           - total sky upward lw flux at toa (w/m**2)     !</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">!       %upfx0           - clear sky upward lw flux at toa (w/m**2)     !</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">!      sfcflw(IM)      : lw radiation fluxes at sfc, component:         !</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">!                        (check module_radlw_paramters for definition)  !</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">!       %upfxc           - total sky upward lw flux at sfc (w/m**2)     !</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="comment">!       %upfx0           - clear sky upward lw flux at sfc (w/m**2)     !</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="comment">!       %dnfxc           - total sky downward lw flux at sfc (w/m**2)   !</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="comment">!       %dnfx0           - clear sky downward lw flux at sfc (w/m**2)   !</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="comment">!      semis (IM)      : surface lw emissivity in fraction              !</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment">!      cldcov(IX,LM)   : 3-d cloud fraction                             !</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">!      tsflw (IM)      : surface air temp during lw calculation in k    !</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="comment">!    input and output variables:                                        !</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">!      fluxr (IX,NFXR) : to save time accumulated 2-d fields defined as:!</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="comment">!                 1      - toa total sky upwd lw radiation flux         !</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="comment">!                 2      - toa total sky upwd sw radiation flux         !</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="comment">!                 3      - sfc total sky upwd sw radiation flux         !</span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="comment">!                 4      - sfc total sky dnwd sw radiation flux         !</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="comment">!                 5      - high domain cloud fraction                   !</span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="comment">!                 6      - mid  domain cloud fraction                   !</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="comment">!                 7      - low  domain cloud fraction                   !</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="comment">!                 8      - high domain mean cloud top pressure          !</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment">!                 9      - mid  domain mean cloud top pressure          !</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="comment">!                10      - low  domain mean cloud top pressure          !</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="comment">!                11      - high domain mean cloud base pressure         !</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment">!                12      - mid  domain mean cloud base pressure         !</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">!                13      - low  domain mean cloud base pressure         !</span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">!                14      - high domain mean cloud top temperature       !</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment">!                15      - mid  domain mean cloud top temperature       !</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment">!                16      - low  domain mean cloud top temperature       !</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="comment">!                17      - total cloud fraction                         !</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="comment">!                18      - boundary layer domain cloud fraction         !</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="comment">!                19      - sfc total sky dnwd lw radiation flux         !</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="comment">!                20      - sfc total sky upwd lw radiation flux         !</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="comment">!                21      - sfc total sky dnwd sw uv-b radiation flux    !</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="comment">!                22      - sfc clear sky dnwd sw uv-b radiation flux    !</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="comment">!                23      - toa incoming solar radiation flux            !</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">!                24      - sfc vis beam dnwd sw radiation flux          !</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment">!                25      - sfc vis diff dnwd sw radiation flux          !</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment">!                26      - sfc nir beam dnwd sw radiation flux          !</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment">!                27      - sfc nir diff dnwd sw radiation flux          !</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment">!                28      - toa clear sky upwd lw radiation flux         !</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="comment">!                29      - toa clear sky upwd sw radiation flux         !</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;<span class="comment">!                30      - sfc clear sky dnwd lw radiation flux         !</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;<span class="comment">!                31      - sfc clear sky upwd sw radiation flux         !</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;<span class="comment">!                32      - sfc clear sky dnwd sw radiation flux         !</span></div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment">!                33      - sfc clear sky upwd lw radiation flux         !</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment">!optional        34      - aeros opt depth at 550nm (all components)    !</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;<span class="comment">!                35      - aeros opt depth at 550nm for du component    !</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment">!                36      - aeros opt depth at 550nm for bc component    !</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment">!                37      - aeros opt depth at 550nm for oc component    !</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;<span class="comment">!                38      - aeros opt depth at 550nm for su component    !</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;<span class="comment">!                39      - aeros opt depth at 550nm for ss component    !</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;<span class="comment">!    optional output variables:                                         !</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;<span class="comment">!      htrswb(IX,LM,NBDSW) : spectral band total sky sw heating rate    !</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment">!      htrlwb(IX,LM,NBDLW) : spectral band total sky lw heating rate    !</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;<span class="comment">!    definitions of internal variable arrays:                           !</span></div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;<span class="comment">!     1. fixed gases:         (defined in &#39;module_radiation_gases&#39;)     !</span></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;<span class="comment">!          gasvmr(:,:,1)  -  co2 volume mixing ratio                    !</span></div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment">!          gasvmr(:,:,2)  -  n2o volume mixing ratio                    !</span></div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;<span class="comment">!          gasvmr(:,:,3)  -  ch4 volume mixing ratio                    !</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="comment">!          gasvmr(:,:,4)  -  o2  volume mixing ratio                    !</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="comment">!          gasvmr(:,:,5)  -  co  volume mixing ratio                    !</span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="comment">!          gasvmr(:,:,6)  -  cf11 volume mixing ratio                   !</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">!          gasvmr(:,:,7)  -  cf12 volume mixing ratio                   !</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">!          gasvmr(:,:,8)  -  cf22 volume mixing ratio                   !</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment">!          gasvmr(:,:,9)  -  ccl4 volume mixing ratio                   !</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;<span class="comment">!     2. cloud profiles:      (defined in &#39;module_radiation_clouds&#39;)    !</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment">!                ---  for  prognostic cloud  ---                        !</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">!          clouds(:,:,1)  -  layer total cloud fraction                 !</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment">!          clouds(:,:,2)  -  layer cloud liq water path                 !</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment">!          clouds(:,:,3)  -  mean effective radius for liquid cloud     !</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="comment">!          clouds(:,:,4)  -  layer cloud ice water path                 !</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;<span class="comment">!          clouds(:,:,5)  -  mean effective radius for ice cloud        !</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;<span class="comment">!          clouds(:,:,6)  -  layer rain drop water path                 !</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;<span class="comment">!          clouds(:,:,7)  -  mean effective radius for rain drop        !</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;<span class="comment">!          clouds(:,:,8)  -  layer snow flake water path                !</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;<span class="comment">!          clouds(:,:,9)  -  mean effective radius for snow flake       !</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;<span class="comment">!                ---  for  diagnostic cloud  ---                        !</span></div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;<span class="comment">!          clouds(:,:,1)  -  layer total cloud fraction                 !</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;<span class="comment">!          clouds(:,:,2)  -  layer cloud optical depth                  !</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;<span class="comment">!          clouds(:,:,3)  -  layer cloud single scattering albedo       !</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;<span class="comment">!          clouds(:,:,4)  -  layer cloud asymmetry factor               !</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;<span class="comment">!     3. surface albedo:      (defined in &#39;module_radiation_surface&#39;)   !</span></div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;<span class="comment">!          sfcalb( :,1 )  -  near ir direct beam albedo                 !</span></div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;<span class="comment">!          sfcalb( :,2 )  -  near ir diffused albedo                    !</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;<span class="comment">!          sfcalb( :,3 )  -  uv+vis direct beam albedo                  !</span></div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;<span class="comment">!          sfcalb( :,4 )  -  uv+vis diffused albedo                     !</span></div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">!     4. sw aerosol profiles: (defined in &#39;module_radiation_aerosols&#39;)  !</span></div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment">!          faersw(:,:,:,1)-  sw aerosols optical depth                  !</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment">!          faersw(:,:,:,2)-  sw aerosols single scattering albedo       !</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment">!          faersw(:,:,:,3)-  sw aerosols asymmetry parameter            !</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;<span class="comment">!     5. lw aerosol profiles: (defined in &#39;module_radiation_aerosols&#39;)  !</span></div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;<span class="comment">!          faerlw(:,:,:,1)-  lw aerosols optical depth                  !</span></div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment">!          faerlw(:,:,:,2)-  lw aerosols single scattering albedo       !</span></div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;<span class="comment">!          faerlw(:,:,:,3)-  lw aerosols asymmetry parameter            !</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="comment">!     6. sw fluxes at toa:    (defined in &#39;module_radsw_main&#39;)          !</span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="comment">!        (topfsw_type -- derived data type for toa rad fluxes)          !</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="comment">!          topfsw(:)%upfxc  -  total sky upward flux at toa             !</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="comment">!          topfsw(:)%dnfxc  -  total sky downward flux at toa           !</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="comment">!          topfsw(:)%upfx0  -  clear sky upward flux at toa             !</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="comment">!     7. lw fluxes at toa:    (defined in &#39;module_radlw_main&#39;)          !</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="comment">!        (topflw_type -- derived data type for toa rad fluxes)          !</span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="comment">!          topflw(:)%upfxc  -  total sky upward flux at toa             !</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment">!          topflw(:)%upfx0  -  clear sky upward flux at toa             !</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="comment">!     8. sw fluxes at sfc:    (defined in &#39;module_radsw_main&#39;)          !</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="comment">!        (sfcfsw_type -- derived data type for sfc rad fluxes)          !</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="comment">!          sfcfsw(:)%upfxc  -  total sky upward flux at sfc             !</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="comment">!          sfcfsw(:)%dnfxc  -  total sky downward flux at sfc           !</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="comment">!          sfcfsw(:)%upfx0  -  clear sky upward flux at sfc             !</span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="comment">!          sfcfsw(:)%dnfx0  -  clear sky downward flux at sfc           !</span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="comment">!     9. lw fluxes at sfc:    (defined in &#39;module_radlw_main&#39;)          !</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment">!        (sfcflw_type -- derived data type for sfc rad fluxes)          !</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="comment">!          sfcflw(:)%upfxc  -  total sky upward flux at sfc             !</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="comment">!          sfcflw(:)%dnfxc  -  total sky downward flux at sfc           !</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="comment">!          sfcflw(:)%dnfx0  -  clear sky downward flux at sfc           !</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">!! optional radiation outputs:                                          !</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">!!   10. sw flux profiles:    (defined in &#39;module_radsw_main&#39;)          !</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">!!       (profsw_type -- derived data type for rad vertical profiles)   !</span></div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">!!         fswprf(:,:)%upfxc - total sky upward flux                    !</span></div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">!!         fswprf(:,:)%dnfxc - total sky downward flux                  !</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">!!         fswprf(:,:)%upfx0 - clear sky upward flux                    !</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">!!         fswprf(:,:)%dnfx0 - clear sky downward flux                  !</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment">!!                                                                      !</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">!!   11. lw flux profiles:    (defined in &#39;module_radlw_main&#39;)          !</span></div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment">!!       (proflw_type -- derived data type for rad vertical profiles)   !</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">!!         flwprf(:,:)%upfxc - total sky upward flux                    !</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment">!!         flwprf(:,:)%dnfxc - total sky downward flux                  !</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;<span class="comment">!!         flwprf(:,:)%upfx0 - clear sky upward flux                    !</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;<span class="comment">!!         flwprf(:,:)%dnfx0 - clear sky downward flux                  !</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;<span class="comment">!!                                                                      !</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;<span class="comment">!!   12. sw sfc components:   (defined in &#39;module_radsw_main&#39;)          !</span></div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment">!!       (cmpfsw_type -- derived data type for component sfc fluxes)    !</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="comment">!!         scmpsw(:)%uvbfc  -  total sky downward uv-b flux at sfc      !</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;<span class="comment">!!         scmpsw(:)%uvbf0  -  clear sky downward uv-b flux at sfc      !</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;<span class="comment">!!         scmpsw(:)%nirbm  -  total sky sfc downward nir direct flux   !</span></div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;<span class="comment">!!         scmpsw(:)%nirdf  -  total sky sfc downward nir diffused flux !</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;<span class="comment">!!         scmpsw(:)%visbm  -  total sky sfc downward uv+vis direct flx !</span></div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment">!!         scmpsw(:)%visdf  -  total sky sfc downward uv+vis diff flux  !</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment">!    external module variables:                                         !</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;<span class="comment">!     ivflip           : control flag for in/out vertical indexing      !</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="comment">!                        =0 index from toa to surface                   !</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;<span class="comment">!                        =1 index from surface to toa                   !</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;<span class="comment">!     icmphys          : cloud microphysics scheme control flag         !</span></div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment">!                        =1 zhao/carr/sundqvist microphysics scheme     !</span></div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="comment">!                        =2 brad ferrier microphysics scheme            !</span></div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="comment">!                        =3 zhao/carr/sundqvist microphysics +pdf cloud !</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;<span class="comment">!    module variables:                                                  !</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;<span class="comment">!     itsfc            : =0 use same sfc skin-air/ground temp           !</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="comment">!                        =1 use diff sfc skin-air/ground temp (not yet) !</span></div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;<span class="comment">!                                                                       !</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment">!  ======================  end of definitions  =======================  !</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      <span class="keywordtype">implicit none</span></div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment">!  ---  inputs: (for rank&gt;1 arrays, horizontal dimensioned by IX)</span></div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;      <span class="keywordtype">integer</span>,  <span class="keywordtype">intent(in)</span> :: IX,IM, LM, NTRAC, NFXR, me,               &amp;</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;     &amp;                        ntoz, ntcw, ncld, ipt, kdt</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      <span class="keywordtype">integer</span>,  <span class="keywordtype">intent(in)</span> :: icsdsw(im), icsdlw(im), jdate(8)</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;      <span class="keywordtype">logical</span>,  <span class="keywordtype">intent(in)</span> :: lsswr, lslwr, lssav, lprnt, shoc_cld</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IX,LM+1)</span>, <span class="keywordtype">intent(in)</span> ::  prsi</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IX,LM)</span>,   <span class="keywordtype">intent(in)</span> ::  prsl,   &amp;</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;     &amp;       prslk, tgrs, qgrs, vvl, fcice, frain, rrime, deltaq, cnvw, &amp;</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;     &amp;       cnvc</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM)</span>, <span class="keywordtype">intent(in)</span> :: flgmin</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;      <span class="keywordtype">real(kind=kind_phys)</span>, <span class="keywordtype">intent(in)</span> :: sup</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM)</span>,      <span class="keywordtype">intent(in)</span> ::  slmsk,  &amp;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;     &amp;       xlon, xlat, tsfc, snowd, zorl, hprim, alvsf, alnsf, alvwf, &amp;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;     &amp;       alnwf, facsf, facwf, cv, cvt, cvb, fice, tisfc,            &amp;</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;     &amp;       sncovr, snoalb, sinlat, coslat</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(in)</span> :: solcon, dtlw, dtsw, solhr,   &amp;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;     &amp;       tracer(IX,LM,NTRAC)</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IX,LM)</span>,<span class="keywordtype">intent(inout)</span>:: cldcov</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">!  ---  outputs: (horizontal dimensioned by IX)</span></div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IX,LM)</span>,<span class="keywordtype">intent(out)</span>:: htrsw,htrlw</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;</div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IX,4)</span>, <span class="keywordtype">intent(out)</span> :: dswcmp,    &amp;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;     &amp;       uswcmp</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM)</span>,   <span class="keywordtype">intent(out)</span>:: tsflw,      &amp;</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;     &amp;       sfalb, semis, coszen, coszdg</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      type(<a class="code" href="namespacemodule__radsw__parameters.html#structmodule__radsw__parameters_1_1topfsw__type">topfsw_type</a>), <span class="keywordtype">dimension(IM)</span>, <span class="keywordtype">intent(out)</span> :: topfsw</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;      type(<a class="code" href="namespacemodule__radsw__parameters.html#structmodule__radsw__parameters_1_1sfcfsw__type">sfcfsw_type</a>), <span class="keywordtype">dimension(IM)</span>, <span class="keywordtype">intent(out)</span> :: sfcfsw</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      type(<a class="code" href="namespacemodule__radlw__parameters.html#structmodule__radlw__parameters_1_1topflw__type">topflw_type</a>), <span class="keywordtype">dimension(IM)</span>, <span class="keywordtype">intent(out)</span> :: topflw</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      type(<a class="code" href="namespacemodule__radlw__parameters.html#structmodule__radlw__parameters_1_1sfcflw__type">sfcflw_type</a>), <span class="keywordtype">dimension(IM)</span>, <span class="keywordtype">intent(out)</span> :: sfcflw</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment">!  ---  variables are for both input and output:</span></div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">intent(inout)</span> :: fluxr(ix,nfxr)</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;<span class="comment">!! ---  optional outputs:</span></div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IX,LM,NBDSW)</span>, <span class="keywordtype">optional</span>,          &amp;</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;     &amp;                       intent(out) :: htrswb</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IX,LM,NBDLW)</span>, <span class="keywordtype">optional</span>,          &amp;</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;     &amp;                       intent(out) :: htrlwb</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(ix,lm)</span>, <span class="keywordtype">optional</span>,                &amp;</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;     &amp;                       intent(out) :: htrlw0</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(ix,lm)</span>, <span class="keywordtype">optional</span>,                &amp;</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;     &amp;                       intent(out) :: htrsw0</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="comment">!  ---  local variables: (horizontal dimensioned by IM)</span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,LM+1+LTP)</span>:: plvl, tlvl</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,LM+LTP)</span>  :: plyr, tlyr, qlyr, &amp;</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;     &amp;       olyr, rhly, qstl, vvel, clw, prslk1, tem2da, tem2db, tvly</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM)</span> :: tsfa, cvt1, cvb1, tem1d,  &amp;</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;     &amp;       sfcemis, tsfg, tskn</div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,LM+LTP,NF_CLDS)</span> :: clouds</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,LM+LTP,NF_VGAS)</span> :: gasvmr</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,       NF_ALBD)</span> :: sfcalb</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,       NSPC1)</span>   :: aerodp     </div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,LM+LTP,NTRAC)</span>   :: tracer1</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,LM+LTP,NBDSW,NF_AESW)</span>::faersw</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,LM+LTP,NBDLW,NF_AELW)</span>::faerlw</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,LM+LTP)</span> :: htswc</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,LM+LTP)</span> :: htlwc</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,LM+LTP)</span> :: gcice, grain, grime</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="comment">!! ---  may be used for optional sw/lw outputs:</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="comment">!!      take out &quot;!!&quot; as needed</span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,LM+LTP)</span>   :: htsw0</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="comment">!!    type (profsw_type),    dimension(IM,LM+1+LTP) :: fswprf</span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      type(<a class="code" href="namespacemodule__radsw__parameters.html#structmodule__radsw__parameters_1_1cmpfsw__type">cmpfsw_type</a>),    <span class="keywordtype">dimension(IM)</span>          :: scmpsw</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,LM+LTP,NBDSW)</span> :: htswb</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,LM+LTP)</span>   :: htlw0</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="comment">!!    type (proflw_type),    dimension(IM,LM+1+LTP) :: flwprf</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span>, <span class="keywordtype">dimension(IM,LM+LTP,NBDLW)</span> :: htlwb</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      <span class="keywordtype">real (kind=kind_phys)</span> :: raddt, es, qs, delt, tem0d, cldsa(im,5)</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      <span class="keywordtype">integer</span> :: i, j, k, k1, lv, icec, itop, ibtc, nday, idxday(im),   &amp;</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;     &amp;       mbota(IM,3), mtopa(IM,3), LP1, nb, LMK, LMP, kd, lla, llb, &amp;</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;     &amp;       lya, lyb, kt, kb</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment">!  ---  for debug test use</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="comment">!     real (kind=kind_phys) :: temlon, temlat, alon, alat</span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="comment">!     integer :: ipt</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="comment">!     logical :: lprnt1</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="comment">!===&gt; ...  begin here</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;      lp1 = lm + 1               <span class="comment">! num of in/out levels</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;<span class="comment">!  --- ...  set local /level/layer indexes corresponding to in/out variables</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      lmk = lm + <a class="code" href="namespacemodule__radiation__driver.html#aab2535e9906afd709124056f4ca1e470">ltp</a>             <span class="comment">! num of local layers</span></div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;      lmp = lmk + 1              <span class="comment">! num of local levels</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="namespacemodule__radiation__driver.html#ad27b36d0186c8147fe839eb5c268d157">lextop</a> ) <span class="keywordflow">then</span></div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="namespacephysparam.html#a7318a941744b1ec62dc9a6ff5bfbb50d">ivflip</a> == 1 ) <span class="keywordflow">then</span>    <span class="comment">! vertical from sfc upward</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;          kd = 0                   <span class="comment">! index diff between in/out and local</span></div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;          kt = 1                   <span class="comment">! index diff between lyr and upper bound</span></div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;          kb = 0                   <span class="comment">! index diff between lyr and lower bound</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;          lla = lmk                <span class="comment">! local index at the 2nd level from top</span></div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;          llb = lmp                <span class="comment">! local index at toa level</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;          lya = lm                 <span class="comment">! local index for the 2nd layer from top</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;          lyb = lp1                <span class="comment">! local index for the top layer</span></div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        <span class="keywordflow">else</span>                       <span class="comment">! vertical from toa downward</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;          kd = 1                   <span class="comment">! index diff between in/out and local</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;          kt = 0                   <span class="comment">! index diff between lyr and upper bound</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;          kb = 1                   <span class="comment">! index diff between lyr and lower bound</span></div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;          lla = 2                  <span class="comment">! local index at the 2nd level from top</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;          llb = 1                  <span class="comment">! local index at toa level</span></div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;          lya = 2                  <span class="comment">! local index for the 2nd layer from top</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;          lyb = 1                  <span class="comment">! local index for the top layer</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;<span class="keywordflow">        endif</span>                    <span class="comment">! end if_ivflip_block</span></div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        kd = 0</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="namespacephysparam.html#a7318a941744b1ec62dc9a6ff5bfbb50d">ivflip</a> == 1 ) <span class="keywordflow">then</span>  <span class="comment">! vertical from sfc upward</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;          kt = 1                   <span class="comment">! index diff between lyr and upper bound</span></div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;          kb = 0                   <span class="comment">! index diff between lyr and lower bound</span></div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        <span class="keywordflow">else</span>                     <span class="comment">! vertical from toa downward</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;          kt = 0                   <span class="comment">! index diff between lyr and upper bound</span></div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;          kb = 1                   <span class="comment">! index diff between lyr and lower bound</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="keywordflow">        endif</span>                    <span class="comment">! end if_ivflip_block</span></div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;<span class="keywordflow">      endif</span>   <span class="comment">! end if_lextop_block</span></div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;      raddt = min(dtsw, dtlw)</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;<span class="comment">!  --- ...  for debug test</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;<span class="comment">!     alon = 120.0</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="comment">!     alat = 29.5</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;<span class="comment">!     ipt = 0</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;<span class="comment">!     do i = 1, IM</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;<span class="comment">!       temlon = xlon(i) * 57.29578</span></div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;<span class="comment">!       if (temlon &lt; 0.0) temlon = temlon + 360.0</span></div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;<span class="comment">!       temlat = xlat(i) * 57.29578</span></div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;<span class="comment">!       lprnt1 = abs(temlon-alon) &lt; 1.1 .and. abs(temlat-alat) &lt; 1.1</span></div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="comment">!       if ( lprnt1 ) then</span></div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment">!         ipt = i</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="comment">!         exit</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;<span class="comment">!       endif</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;<span class="comment">!     enddo</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;<span class="comment">!     print *,&#39; in grrad : raddt=&#39;,raddt</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="comment">!  --- ...  setup surface ground temp and ground/air skin temp if required</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="namespacemodule__radiation__driver.html#a9ee6a89464bf206cc07ea30d7eeaaeb8">itsfc</a> == 0 ) <span class="keywordflow">then</span>            <span class="comment">! use same sfc skin-air/ground temp</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;          tskn(i) = tsfc(i)</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;          tsfg(i) = tsfc(i)</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      <span class="keywordflow">else</span>                              <span class="comment">! use diff sfc skin-air/ground temp</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="comment">!!        tskn(i) = ta  (i)               ! not yet</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="comment">!!        tsfg(i) = tg  (i)               ! not yet</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;          tskn(i) = tsfc(i)</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;          tsfg(i) = tsfc(i)</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="comment">!  --- ...  prepare atmospheric profiles for radiation input</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="comment">!     if (im &gt; ipt) then</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="comment">!       write(0,*)&#39; prsi=&#39;,prsi(ipt,1:10)</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="comment">!       write(0,*)&#39; prsi=&#39;,prsl(ipt,1:10)</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="comment">!       write(0,*)&#39; tgrs=&#39;,tgrs(ipt,1:10)</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="comment">!     endif</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;<span class="comment">!           convert pressure unit from pa to mb</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;      <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;        k1 = k + kd</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;<span class="comment">!         plvl(i,k1)   = 10.0 * prsi(i,k)   ! cb (kpa) to mb (hpa)</span></div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;<span class="comment">!         plyr(i,k1)   = 10.0 * prsl(i,k)   ! cb (kpa) to mb (hpa)</span></div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;          plvl(i,k1)   = 0.01 * prsi(i,k)   <span class="comment">! pa to mb (hpa)</span></div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;          plyr(i,k1)   = 0.01 * prsl(i,k)   <span class="comment">! pa to mb (hpa)</span></div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;          tlyr(i,k1)   = tgrs(i,k)</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;          prslk1(i,k1) = prslk(i,k)</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;<span class="comment">!  --- ...  compute relative humidity</span></div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;<span class="comment">!         es  = min( prsl(i,k), 0.001 * fpvs( tgrs(i,k) ) )   ! fpvs in pa</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;          es  = min( prsl(i,k),  fpvs( tgrs(i,k) ) )  <span class="comment">! fpvs and prsl in pa</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;          qs  = max( <a class="code" href="namespacemodule__radiation__driver.html#afdc2a7e1dbfb075ac33a2388564d9428">qmin</a>, eps * es / (prsl(i,k) + epsm1*es) )</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;          rhly(i,k1) = max( 0.0, min( 1.0, max(<a class="code" href="namespacemodule__radiation__driver.html#afdc2a7e1dbfb075ac33a2388564d9428">qmin</a>, qgrs(i,k))/qs ) )</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;          qstl(i,k1) = qs</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      <span class="keywordflow">do</span> j = 1, ntrac</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;        <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;          k1 = k + kd</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;             tracer1(i,k1,j) = tracer(i,k,j)</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;      <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="comment">!       plvl(i,LP1+kd) = 10.0 * prsi(i,LP1)  ! cb (kpa) to mb (hpa</span></div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        plvl(i,lp1+kd) = 0.01 * prsi(i,lp1)  <span class="comment">! pa to mb (hpa)</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      <span class="keywordflow">if</span> ( <a class="code" href="namespacemodule__radiation__driver.html#ad27b36d0186c8147fe839eb5c268d157">lextop</a> ) <span class="keywordflow">then</span>                 <span class="comment">! values for extra top layer</span></div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;          plvl(i,llb) = <a class="code" href="namespacemodule__radiation__driver.html#a3fc43ca0d2c5f69a380ddb4f0926ecc7">prsmin</a></div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;          <span class="keywordflow">if</span> ( plvl(i,lla) &lt;= <a class="code" href="namespacemodule__radiation__driver.html#a3fc43ca0d2c5f69a380ddb4f0926ecc7">prsmin</a> ) plvl(i,lla) = 2.0*<a class="code" href="namespacemodule__radiation__driver.html#a3fc43ca0d2c5f69a380ddb4f0926ecc7">prsmin</a></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;          plyr(i,lyb)   = 0.5 * plvl(i,lla)</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;          tlyr(i,lyb)   = tlyr(i,lya)</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">!         prslk1(i,lyb) = (plyr(i,lyb)*0.001) ** rocp   ! plyr in hPa</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;          prslk1(i,lyb) = (plyr(i,lyb)*0.00001) ** rocp <span class="comment">! plyr in Pa</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;          rhly(i,lyb)   = rhly(i,lya)</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;          qstl(i,lyb)   = qstl(i,lya)</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        <span class="keywordflow">do</span> j = 1, ntrac</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment">!  ---  note: may need to take care the top layer amount</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;             tracer1(i,lyb,j) = tracer1(i,lya,j)</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="keywordflow">      endif</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment">!  --- ...  extra variables needed for ferrier&#39;s microphysics</span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacephysparam.html#af259ebea0c378b3b07343141977db03e">icmphys</a> == 2) <span class="keywordflow">then</span></div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;          k1 = k + kd</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;            gcice(i,k1) = fcice(i,k)</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;            grain(i,k1) = frain(i,k)</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;            grime(i,k1) = rrime(i,k)</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="namespacemodule__radiation__driver.html#ad27b36d0186c8147fe839eb5c268d157">lextop</a> ) <span class="keywordflow">then</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;            gcice(i,lyb) = fcice(i,lya)</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;            grain(i,lyb) = frain(i,lya)</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;            grime(i,lyb) = rrime(i,lya)</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;<span class="keywordflow">      endif</span>   <span class="comment">! if_icmphys</span></div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment">!  --- ...  get layer ozone mass mixing ratio</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;      <span class="keywordflow">if</span> (ntoz &gt; 0) <span class="keywordflow">then</span>            <span class="comment">! interactive ozone generation</span></div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        <span class="keywordflow">do</span> k = 1, lmk</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;            olyr(i,k) = max( <a class="code" href="namespacemodule__radiation__driver.html#afdc2a7e1dbfb075ac33a2388564d9428">qmin</a>, tracer1(i,k,ntoz) )</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;      <span class="keywordflow">else</span>                          <span class="comment">! climatological ozone</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment">!     print *,&#39; in grrad : calling getozn&#39;</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__gases.html#af4be311f1ec1601a167655c1632d66de">getozn</a>                                                     &amp;</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;     &amp;     ( prslk1,xlat,                                               &amp;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;     &amp;       im, lmk,                                                   &amp;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;     &amp;       olyr                                                       &amp;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;     &amp;     )</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="keywordflow">      endif</span>                            <span class="comment">! end_if_ntoz</span></div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment">!  --- ...  compute cosin of zenith angle</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__astronomy.html#a8ce5ecf0524d0460baf6c467b532085c">coszmn</a>                                                       &amp;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;     &amp;     ( xlon,sinlat,coslat,solhr, im, me,                          &amp;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;     &amp;       coszen, coszdg                                             &amp;</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;     &amp;      )</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;<span class="comment">!  --- ...  set up non-prognostic gas volume mixing ratioes</span></div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__gases.html#ad06401a54d361b3dd852d815d1b0f71e">getgases</a>                                                     &amp;</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;     &amp;    ( plvl, xlon, xlat,                                           &amp;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;     &amp;      im, lmk,                                                    &amp;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;     &amp;      gasvmr                                                      &amp;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;     &amp;     )</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;<span class="comment">!  --- ...  get temperature at layer interface, and layer moisture</span></div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;      <span class="keywordflow">do</span> k = 2, lmk</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;          tem2da(i,k) = log( plyr(i,k) )</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;          tem2db(i,k) = log( plvl(i,k) )</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacephysparam.html#a7318a941744b1ec62dc9a6ff5bfbb50d">ivflip</a> == 0) <span class="keywordflow">then</span>              <span class="comment">! input data from toa to sfc</span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;          tem1d(i)   = <a class="code" href="namespacemodule__radiation__driver.html#a4916e37c472b2f824b6f566ff67200cd">qme6</a></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;          tem2da(i,1) = log( plyr(i,1) )</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;          tem2db(i,1) = 1.0</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;          tsfa(i)   = tlyr(i,lmk)                  <span class="comment">! sfc layer air temp</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;          tlvl(i,1)   = tlyr(i,1)</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;          tlvl(i,lmp) = tskn(i)</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;        <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;          k1 = k + kd</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;            qlyr(i,k1) = max( tem1d(i), qgrs(i,k) )</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;            tem1d(i)   = min( <a class="code" href="namespacemodule__radiation__driver.html#ab671cb80142c71dab5f41f01ccdcc088">qme5</a>, qlyr(i,k1) )</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;            tvly(i,k1) = tgrs(i,k) * (1.0 + fvirt*qlyr(i,k1)) <span class="comment">! virtual T (K)</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="namespacemodule__radiation__driver.html#ad27b36d0186c8147fe839eb5c268d157">lextop</a> ) <span class="keywordflow">then</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;            qlyr(i,lyb) = qlyr(i,lya)</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;            tvly(i,lyb) = tvly(i,lya)</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;        <span class="keywordflow">do</span> k = 2, lmk</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;            tlvl(i,k) = tlyr(i,k) + (tlyr(i,k-1) - tlyr(i,k))           &amp;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;     &amp;                * (tem2db(i,k)   - tem2da(i,k))                   &amp;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;     &amp;                / (tem2da(i,k-1) - tem2da(i,k))</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;      <span class="keywordflow">else</span>                               <span class="comment">! input data from sfc to toa</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;          tem1d(i)   = <a class="code" href="namespacemodule__radiation__driver.html#a4916e37c472b2f824b6f566ff67200cd">qme6</a></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;          tem2da(i,1) = log( plyr(i,1) )</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;          tem2db(i,1) = log( plvl(i,1) )</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;          tsfa(i)   = tlyr(i,1)                    <span class="comment">! sfc layer air temp</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;          tlvl(i,1)   = tskn(i)</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;          tlvl(i,lmp) = tlyr(i,lmk)</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        <span class="keywordflow">do</span> k = lm, 1, -1</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;            qlyr(i,k) = max( tem1d(i), qgrs(i,k) )</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;            tem1d(i)  = min( <a class="code" href="namespacemodule__radiation__driver.html#ab671cb80142c71dab5f41f01ccdcc088">qme5</a>, qlyr(i,k) )</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;            tvly(i,k) = tgrs(i,k) * (1.0 + fvirt*qlyr(i,k)) <span class="comment">! virtual T (K)</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="namespacemodule__radiation__driver.html#ad27b36d0186c8147fe839eb5c268d157">lextop</a> ) <span class="keywordflow">then</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;            qlyr(i,lyb) = qlyr(i,lya)</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            tvly(i,lyb) = tvly(i,lya)</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        <span class="keywordflow">do</span> k = 1, lmk-1</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            tlvl(i,k+1) = tlyr(i,k) + (tlyr(i,k+1) - tlyr(i,k))         &amp;</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;     &amp;                  * (tem2db(i,k+1) - tem2da(i,k))                 &amp;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;     &amp;                  / (tem2da(i,k+1) - tem2da(i,k))</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="keywordflow">      endif</span>                              <span class="comment">! end_if_ivflip</span></div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment">!  --- ...  check for daytime points </span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;      nday = 0</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;      <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        <span class="keywordflow">if</span> (coszen(i) &gt;= 0.0001) <span class="keywordflow">then</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;          nday = nday + 1</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;          idxday(nday) = i</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="keywordflow">      enddo</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="comment">!      write(0,*)&#39; plvl=&#39;,plvl(ipt,1:65)</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="comment">!      write(0,*)&#39; plyr=&#39;,plyr(ipt,1:64)</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="comment">!      write(0,*)&#39; tlyr=&#39;,tlyr(ipt,1:64)</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="comment">!      write(0,*)&#39; tlvl=&#39;,tlvl(ipt,1:65)</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;<span class="comment">!      write(0,*)&#39; qlyr=&#39;,qlyr(ipt,1:10)*1000</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment">!  --- ...  setup aerosols property profile for radiation</span></div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="comment">!check  print *,&#39; in grrad : calling setaer &#39;</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;      <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__aerosols.html#a94a9a162f822d2ee5c5bff611403dd06">setaer</a>                                                       &amp;</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;     &amp;     ( plvl,plyr,prslk1,tvly,rhly,slmsk,tracer1,xlon,xlat,        &amp;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;     &amp;       im,lmk,lmp, lsswr,lslwr,                                   &amp;</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;     &amp;       faersw,faerlw,aerodp                                       &amp;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;     &amp;     )</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;<span class="comment">!  --- ...  obtain cloud information for radiation calculations</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;      <span class="keywordflow">if</span> (ntcw &gt; 0) <span class="keywordflow">then</span>                   <span class="comment">! prognostic cloud scheme</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;        <span class="keywordflow">do</span> k = 1, lmk</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;            clw(i,k) = 0.0</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;          <span class="keywordflow">do</span> j = 1, ncld</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;            lv = ntcw + j - 1</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;            <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;              clw(i,k) = clw(i,k) + tracer1(i,k,lv)   <span class="comment">! cloud condensate amount</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;        <span class="keywordflow">do</span> k = 1, lmk</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;            <span class="keywordflow">if</span> ( clw(i,k) &lt; <a class="code" href="namespacemodule__radiation__driver.html#a0b0bf0fa8723b80d0891ec3327d187d7">epsq</a> ) clw(i,k) = 0.0</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacephysparam.html#af259ebea0c378b3b07343141977db03e">icmphys</a> == 1) <span class="keywordflow">then</span>           <span class="comment">! zhao/moorthi&#39;s prognostic cloud scheme</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__clouds.html#ab45374e1eeec7d6211284b38c3ec8448">progcld1</a>                                                 &amp;</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;     &amp;     ( plyr,plvl,tlyr,tvly,qlyr,qstl,rhly,clw,                    &amp;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;     &amp;       xlat,xlon,slmsk,                                           &amp;</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;     &amp;       im, lmk, lmp, shoc_cld, cldcov(1:im,1:lm),                 &amp;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;     &amp;       clouds,cldsa,mtopa,mbota                                   &amp;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;     &amp;      )</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;        <span class="keywordflow">elseif</span> (<a class="code" href="namespacephysparam.html#af259ebea0c378b3b07343141977db03e">icmphys</a> == 2) <span class="keywordflow">then</span>       <span class="comment">! ferrier&#39;s microphysics</span></div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment">!     print *,&#39; in grrad : calling progcld2&#39;</span></div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__clouds.html#a2f45f48505bb69a968c788ff680b5642">progcld2</a>                                                 &amp;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;     &amp;     ( plyr,plvl,tlyr,tvly,qlyr,qstl,rhly,clw,                    &amp;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;     &amp;       xlat,xlon,slmsk, gcice,grain,grime,flgmin,                 &amp;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;     &amp;       im, lmk, lmp,                                              &amp;</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;     &amp;       clouds,cldsa,mtopa,mbota                                   &amp;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;     &amp;      )</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        <span class="keywordflow">elseif</span>(<a class="code" href="namespacephysparam.html#af259ebea0c378b3b07343141977db03e">icmphys</a> == 3) <span class="keywordflow">then</span>      <span class="comment">! zhao/moorthi&#39;s prognostic cloud+pdfcld</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__clouds.html#a1953118ed22c3b6f8d94ef231b47a08b">progcld3</a>                                                 &amp;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;     &amp;     ( plyr,plvl,tlyr,tvly,qlyr,qstl,rhly,clw,cnvw,cnvc,          &amp;</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;     &amp;       xlat,xlon,slmsk,                                           &amp;</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;     &amp;       im, lmk, lmp,                                              &amp;</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;     &amp;       deltaq, sup,kdt,me,                                        &amp;</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;     &amp;       clouds,cldsa,mtopa,mbota                                   &amp;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;     &amp;      )</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="keywordflow">        endif</span>                            <span class="comment">! end if_icmphys</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      <span class="keywordflow">else</span>                               <span class="comment">! diagnostic cloud scheme</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="comment">!         cvt1(i) = 10.0 * cvt(i)</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="comment">!         cvb1(i) = 10.0 * cvb(i)</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;          cvt1(i) = 0.01 * cvt(i)</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;          cvb1(i) = 0.01 * cvb(i)</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;        <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;          k1 = k + kd</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;<span class="comment">!           vvel(i,k1) = 10.0 * vvl(i,k)</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;            vvel(i,k1) = 0.01 * vvl(i,k)</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="namespacemodule__radiation__driver.html#ad27b36d0186c8147fe839eb5c268d157">lextop</a> ) <span class="keywordflow">then</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;            vvel(i,lyb) = vvel(i,lya)</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment">!  ---  compute diagnostic cloud related quantities</span></div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__clouds.html#ab477be986b08fe827c44dbe352a23d39">diagcld1</a>                                                   &amp;</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;     &amp;     ( plyr,plvl,tlyr,rhly,vvel,cv,cvt1,cvb1,                     &amp;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;     &amp;       xlat,xlon,slmsk,                                           &amp;</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;     &amp;       im, lmk, lmp,                                              &amp;</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;     &amp;       clouds,cldsa,mtopa,mbota                                   &amp;</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;     &amp;      )</div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;<span class="keywordflow">      endif</span>                                <span class="comment">! end_if_ntcw</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;<span class="comment">!  --- ...  start radiation calculations </span></div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment">!           remember to set heating rate unit to k/sec!</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;      <span class="keywordflow">if</span> (lsswr) <span class="keywordflow">then</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="comment">!  ---  setup surface albedo for sw radiation, incl xw (nov04) sea-ice</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__surface.html#a79d2feaf2f32435b179ef7bc86ad3f36">setalb</a>                                                     &amp;</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;     &amp;     ( slmsk,snowd,sncovr,snoalb,zorl,coszen,tsfg,tsfa,hprim,     &amp;</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;     &amp;       alvsf,alnsf,alvwf,alnwf,facsf,facwf,fice,tisfc,            &amp;</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;     &amp;       im,                                                        &amp;</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;     &amp;       sfcalb                                                     &amp;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;     &amp;     )</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="comment">!  ---  approximate mean surface albedo from vis- and nir- diffuse values</span></div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;          sfalb(i) = max(0.01, 0.5 * (sfcalb(i,2) + sfcalb(i,4)))</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        <span class="keywordflow">if</span> (nday &gt; 0) <span class="keywordflow">then</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="comment">!     print *,&#39; in grrad : calling swrad&#39;</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;          <span class="keywordflow">if</span> ( <span class="keyword">present</span>(htrswb) .and. <span class="keyword">present</span>(htrsw0)) <span class="keywordflow">then</span></div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;            <span class="keyword">call </span><a class="code" href="namespacemodule__radsw__main.html#ad9b28f997232642658b4d15a7eb70fcd">swrad</a>                                                  &amp;</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;     &amp;     ( plyr,plvl,tlyr,tlvl,qlyr,olyr,gasvmr,                      &amp;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;     &amp;       clouds,icsdsw,faersw,sfcalb,                               &amp;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;     &amp;       coszen,solcon, nday,idxday,                                &amp;</div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;     &amp;       im, lmk, lmp, lprnt,                                       &amp;</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;     &amp;       htswc,topfsw,sfcfsw                                        &amp;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="comment">!! ---  optional:</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;<span class="comment">!!   &amp;,      HSW0=htsw0,FLXPRF=fswprf                                   &amp;</span></div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;     &amp;,      hsw0=htsw0,hswb=htswb,fdncmp=scmpsw                        &amp;</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;     &amp;     )</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;            <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;              k1 = k + kd</div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;              <span class="keywordflow">do</span> j = 1, <a class="code" href="namespacemodule__radsw__parameters.html#ab1e121fde29dde00871e4a7d43be1ddb">nbdsw</a></div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;                <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                  htrswb(i,k,j) = htswb(i,k1,j)</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <span class="keyword">present</span>(htrswb) .and. .not. <span class="keyword">present</span>(htrsw0) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;            <span class="keyword">call </span><a class="code" href="namespacemodule__radsw__main.html#ad9b28f997232642658b4d15a7eb70fcd">swrad</a>                                                  &amp;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;     &amp;     ( plyr,plvl,tlyr,tlvl,qlyr,olyr,gasvmr,                      &amp;</div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;     &amp;       clouds,icsdsw,faersw,sfcalb,                               &amp;</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;     &amp;       coszen,solcon, nday,idxday,                                &amp;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;     &amp;       im, lmk, lmp, lprnt,                                       &amp;</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;     &amp;       htswc,topfsw,sfcfsw                                        &amp;</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;<span class="comment">!! ---  optional:</span></div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;<span class="comment">!!   &amp;,      hsw0=htsw0,flxprf=fswprf                                   &amp;</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;     &amp;,      hswb=htswb,fdncmp=scmpsw                                   &amp;</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;     &amp;     )</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;            <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;              k1 = k + kd</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;              <span class="keywordflow">do</span> j = 1, <a class="code" href="namespacemodule__radsw__parameters.html#ab1e121fde29dde00871e4a7d43be1ddb">nbdsw</a></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                  htrswb(i,k,j) = htswb(i,k1,j)</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <span class="keyword">present</span>(htrsw0) .and. .not. <span class="keyword">present</span>(htrswb) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;            <span class="keyword">call </span><a class="code" href="namespacemodule__radsw__main.html#ad9b28f997232642658b4d15a7eb70fcd">swrad</a>                                                  &amp;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;     &amp;     ( plyr,plvl,tlyr,tlvl,qlyr,olyr,gasvmr,                      &amp;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;     &amp;       clouds,icsdsw,faersw,sfcalb,                               &amp;</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;     &amp;       coszen,solcon, nday,idxday,                                &amp;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;     &amp;       im, lmk, lmp, lprnt,                                       &amp;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;     &amp;       htswc,topfsw,sfcfsw                                        &amp;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;<span class="comment">!! ---  optional:</span></div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;<span class="comment">!!   &amp;,      hsw0=htsw0,flxprf=fswprf                                   &amp;</span></div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;     &amp;,      hsw0=htsw0,fdncmp=scmpsw                                   &amp;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;     &amp;     )</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;            <span class="keyword">call </span><a class="code" href="namespacemodule__radsw__main.html#ad9b28f997232642658b4d15a7eb70fcd">swrad</a>                                                  &amp;</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;     &amp;     ( plyr,plvl,tlyr,tlvl,qlyr,olyr,gasvmr,                      &amp;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;     &amp;       clouds,icsdsw,faersw,sfcalb,                               &amp;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;     &amp;       coszen,solcon, nday,idxday,                                &amp;</div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;     &amp;       im, lmk, lmp, lprnt,                                       &amp;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;     &amp;       htswc,topfsw,sfcfsw                                        &amp;</div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;<span class="comment">!! ---  optional:</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;<span class="comment">!!   &amp;,      HSW0=htsw0,FLXPRF=fswprf,HSWB=htswb                        &amp;</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;     &amp;,      fdncmp=scmpsw                                              &amp;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;     &amp;     )</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;          <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;            k1 = k + kd</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;            <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;              htrsw(i,k) = htswc(i,k1)</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;          <span class="keywordflow">if</span> (<span class="keyword">present</span>(htrsw0)) <span class="keywordflow">then</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;             <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;               k1 = k + kd</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;               <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;                 htrsw0(i,k) = htsw0(i,k1)</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="keywordflow">               enddo</span></div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="keywordflow">             enddo</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="comment">!  --- surface down and up spectral component fluxes</span></div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;</div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;            dswcmp(i,1) = scmpsw(i)%nirbm</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;            dswcmp(i,2) = scmpsw(i)%nirdf</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;            dswcmp(i,3) = scmpsw(i)%visbm</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;            dswcmp(i,4) = scmpsw(i)%visdf</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;            uswcmp(i,1) = scmpsw(i)%nirbm * sfcalb(i,1)</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;            uswcmp(i,2) = scmpsw(i)%nirdf * sfcalb(i,2)</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;            uswcmp(i,3) = scmpsw(i)%visbm * sfcalb(i,3)</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;            uswcmp(i,4) = scmpsw(i)%visdf * sfcalb(i,4)</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        <span class="keywordflow">else</span>                   <span class="comment">! if_nday_block</span></div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;          <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;            <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;              htrsw(i,k) = 0.0</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;</div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;          sfcfsw = <a class="code" href="namespacemodule__radsw__parameters.html#structmodule__radsw__parameters_1_1sfcfsw__type">sfcfsw_type</a>( 0.0, 0.0, 0.0, 0.0 )</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;          topfsw = <a class="code" href="namespacemodule__radsw__parameters.html#structmodule__radsw__parameters_1_1topfsw__type">topfsw_type</a>( 0.0, 0.0, 0.0 )</div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;          scmpsw = <a class="code" href="namespacemodule__radsw__parameters.html#structmodule__radsw__parameters_1_1cmpfsw__type">cmpfsw_type</a>( 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 )</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;</div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;          <span class="keywordflow">do</span> k = 1, 4</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;            dswcmp(i,k) = 0.0</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;            uswcmp(i,k) = 0.0</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;<span class="comment">!! ---  optional:</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;<span class="comment">!!        fswprf= profsw_type( 0.0, 0.0, 0.0, 0.0 )</span></div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;          <span class="keywordflow">if</span> ( <span class="keyword">present</span>(htrswb) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;            <span class="keywordflow">do</span> j = 1, <a class="code" href="namespacemodule__radsw__parameters.html#ab1e121fde29dde00871e4a7d43be1ddb">nbdsw</a></div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;              <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                  htrswb(i,k,j) = 0.0</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;          <span class="keywordflow">if</span> ( <span class="keyword">present</span>(htrsw0) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;              <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;                <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;                  htrsw0(i,k) = 0.0</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;<span class="keywordflow">                enddo</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;<span class="keywordflow">          endif</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;<span class="keywordflow">        endif</span>                  <span class="comment">! end_if_nday</span></div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;<span class="keywordflow">      endif</span>                                <span class="comment">! end_if_lsswr</span></div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;<span class="comment">!      write(0,*)&#39; htrsw=&#39;,htrsw(ipt,1:64)*86400</span></div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;      <span class="keywordflow">if</span> (lslwr) <span class="keywordflow">then</span></div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;<span class="comment">!  ---  setup surface emissivity for lw radiation</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;        <span class="keyword">call </span><a class="code" href="namespacemodule__radiation__surface.html#a0fdd0e9a9c536d3d41bd6b6c9d0a8675">setemis</a>                                                    &amp;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;     &amp;     ( xlon,xlat,slmsk,snowd,sncovr,zorl,tsfg,tsfa,hprim,         &amp;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;     &amp;       im,                                                        &amp;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;     &amp;       sfcemis                                                    &amp;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;     &amp;     )</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment">!     print *,&#39; in grrad : calling lwrad&#39;</span></div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;        <span class="keywordflow">if</span> ( <span class="keyword">present</span>(htrlwb) .and. <span class="keyword">present</span>(htrlw0) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacemodule__radlw__main.html#a072a355f2067d729d64d2997270e36b1">lwrad</a>                                                    &amp;</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;     &amp;     ( plyr,plvl,tlyr,tlvl,qlyr,olyr,gasvmr,                      &amp;</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;     &amp;       clouds,icsdlw,faerlw,sfcemis,tsfg,                         &amp;</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;     &amp;       im, lmk, lmp, lprnt,                                       &amp;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;     &amp;       htlwc,topflw,sfcflw                                        &amp;</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;<span class="comment">!! ---  optional:</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;<span class="comment">!!   &amp;,      HLW0=htlw0,FLXPRF=flwprf                                   &amp;</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;     &amp;,      hlw0=htlw0                                                 &amp;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;     &amp;,      hlwb=htlwb                                                 &amp;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;     &amp;     )</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;          <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;            k1 = k + kd</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;            <span class="keywordflow">do</span> j = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a39a115a97296886b2e6e37b220e942c7">nbdlw</a></div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;              <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                htrlwb(i,k,j) = htlwb(i,k1,j)</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <span class="keyword">present</span>(htrlwb) .and. .not. <span class="keyword">present</span>(htrlw0) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacemodule__radlw__main.html#a072a355f2067d729d64d2997270e36b1">lwrad</a>                                                    &amp;</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;     &amp;     ( plyr,plvl,tlyr,tlvl,qlyr,olyr,gasvmr,                      &amp;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;     &amp;       clouds,icsdlw,faerlw,sfcemis,tsfg,                         &amp;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;     &amp;       im, lmk, lmp, lprnt,                                       &amp;</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;     &amp;       htlwc,topflw,sfcflw                                        &amp;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;<span class="comment">!! ---  optional:</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;<span class="comment">!!   &amp;,      hlw0=htlw0,flxprf=flwprf                                   &amp;</span></div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;     &amp;,      hlwb=htlwb                                                 &amp;</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;     &amp;     )</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;          <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;            k1 = k + kd</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;            <span class="keywordflow">do</span> j = 1, <a class="code" href="namespacemodule__radlw__parameters.html#a39a115a97296886b2e6e37b220e942c7">nbdlw</a></div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;              <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                htrlwb(i,k,j) = htlwb(i,k1,j)</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;<span class="keywordflow">              enddo</span></div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( <span class="keyword">present</span>(htrlw0) .and. .not. <span class="keyword">present</span>(htrlwb) ) <span class="keywordflow">then</span></div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;          <span class="comment">!print *,&#39;call lwrad saving clear sky component&#39;</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacemodule__radlw__main.html#a072a355f2067d729d64d2997270e36b1">lwrad</a>                                                    &amp;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;     &amp;     ( plyr,plvl,tlyr,tlvl,qlyr,olyr,gasvmr,                      &amp;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;     &amp;       clouds,icsdlw,faerlw,sfcemis,tsfg,                         &amp;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;     &amp;       im, lmk, lmp, lprnt,                                       &amp;</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;     &amp;       htlwc,topflw,sfcflw                                        &amp;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;<span class="comment">!! ---  optional:</span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;<span class="comment">!!   &amp;,      hlw0=htlw0,flxprf=flwprf                                   &amp;</span></div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;     &amp;,      hlw0=htlw0                                                 &amp;</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;     &amp;     )</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;          <span class="keyword">call </span><a class="code" href="namespacemodule__radlw__main.html#a072a355f2067d729d64d2997270e36b1">lwrad</a>                                                    &amp;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;<span class="comment">!  ---  inputs:</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;     &amp;     ( plyr,plvl,tlyr,tlvl,qlyr,olyr,gasvmr,                      &amp;</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;     &amp;       clouds,icsdlw,faerlw,sfcemis,tsfg,                         &amp;</div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;     &amp;       im, lmk, lmp, lprnt,                                       &amp;</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="comment">!  ---  outputs:</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;     &amp;       htlwc,topflw,sfcflw                                        &amp;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="comment">!! ---  optional:</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="comment">!!   &amp;,      HLW0=htlw0,FLXPRF=flwprf,HLWB=htlwb                        &amp;</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;     &amp;     )</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;          semis(i) = sfcemis(i)</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;<span class="comment">!  ---  save surface air temp for diurnal adjustment at model t-steps</span></div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;          tsflw(i) = tsfa(i)</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;          k1 = k + kd</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;            htrlw(i,k) = htlwc(i,k1)</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;<span class="keywordflow">        enddo</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">present</span>(htrlw0)) <span class="keywordflow">then</span></div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;           <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;             k1 = k + kd</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;             <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;               htrlw0(i,k) = htlw0(i,k1)</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;<span class="keywordflow">             enddo</span></div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;<span class="keywordflow">           enddo</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;<span class="keywordflow">      endif</span>                                <span class="comment">! end_if_lslwr</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;<span class="comment">!  --- ...  collect the fluxr data for wrtsfc</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      <span class="keywordflow">if</span> (lssav) <span class="keywordflow">then</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;         <span class="keywordflow">if</span> ( lsswr ) <span class="keywordflow">then</span></div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;             fluxr(i,34) = fluxr(i,34) + dtsw*aerodp(i,1)  <span class="comment">! total aod at 550nm</span></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;             fluxr(i,35) = fluxr(i,35) + dtsw*aerodp(i,2)  <span class="comment">! DU aod at 550nm</span></div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;             fluxr(i,36) = fluxr(i,36) + dtsw*aerodp(i,3)  <span class="comment">! BC aod at 550nm</span></div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;             fluxr(i,37) = fluxr(i,37) + dtsw*aerodp(i,4)  <span class="comment">! OC aod at 550nm</span></div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;             fluxr(i,38) = fluxr(i,38) + dtsw*aerodp(i,5)  <span class="comment">! SU aod at 550nm</span></div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;             fluxr(i,39) = fluxr(i,39) + dtsw*aerodp(i,6)  <span class="comment">! SS aod at 550nm</span></div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;<span class="comment">!  ---  save lw toa and sfc fluxes</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;        <span class="keywordflow">if</span> (lslwr) <span class="keywordflow">then</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;<span class="comment">!  ---  lw total-sky fluxes</span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;            fluxr(i,1 ) = fluxr(i,1 ) + dtlw * topflw(i)%upfxc   <span class="comment">! total sky top lw up</span></div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;            fluxr(i,19) = fluxr(i,19) + dtlw * sfcflw(i)%dnfxc   <span class="comment">! total sky sfc lw dn</span></div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;            fluxr(i,20) = fluxr(i,20) + dtlw * sfcflw(i)%upfxc   <span class="comment">! total sky sfc lw up</span></div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;<span class="comment">!  ---  lw clear-sky fluxes</span></div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;            fluxr(i,28) = fluxr(i,28) + dtlw * topflw(i)%upfx0   <span class="comment">! clear sky top lw up</span></div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;            fluxr(i,30) = fluxr(i,30) + dtlw * sfcflw(i)%dnfx0   <span class="comment">! clear sky sfc lw dn</span></div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;            fluxr(i,33) = fluxr(i,33) + dtlw * sfcflw(i)%upfx0   <span class="comment">! clear sky sfc lw up</span></div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;<span class="comment">!  ---  save sw toa and sfc fluxes with proper diurnal sw wgt. coszen=mean cosz over daylight</span></div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="comment">!       part of sw calling interval, while coszdg= mean cosz over entire interval</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;        <span class="keywordflow">if</span> (lsswr) <span class="keywordflow">then</span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;            <span class="keywordflow">if</span> (coszen(i) &gt; 0.) <span class="keywordflow">then</span></div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;<span class="comment">!  ---                                  sw total-sky fluxes</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="comment">!                                       -------------------</span></div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;              tem0d = dtsw * coszdg(i)  / coszen(i)</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;              fluxr(i,2 ) = fluxr(i,2)  + topfsw(i)%upfxc * tem0d  <span class="comment">! total sky top sw up</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;              fluxr(i,3 ) = fluxr(i,3)  + sfcfsw(i)%upfxc * tem0d  <span class="comment">! total sky sfc sw up</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;              fluxr(i,4 ) = fluxr(i,4)  + sfcfsw(i)%dnfxc * tem0d  <span class="comment">! total sky sfc sw dn</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;<span class="comment">!  ---                                  sw uv-b fluxes</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="comment">!                                       --------------</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;              fluxr(i,21) = fluxr(i,21) + scmpsw(i)%uvbfc * tem0d  <span class="comment">! total sky uv-b sw dn</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;              fluxr(i,22) = fluxr(i,22) + scmpsw(i)%uvbf0 * tem0d  <span class="comment">! clear sky uv-b sw dn</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;<span class="comment">!  ---                                  sw toa incoming fluxes</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="comment">!                                       ----------------------</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;              fluxr(i,23) = fluxr(i,23) + topfsw(i)%dnfxc * tem0d  <span class="comment">! top sw dn</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="comment">!  ---                                  sw sfc flux components</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;<span class="comment">!                                       ----------------------</span></div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;              fluxr(i,24) = fluxr(i,24) + scmpsw(i)%visbm * tem0d  <span class="comment">! uv/vis beam sw dn</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;              fluxr(i,25) = fluxr(i,25) + scmpsw(i)%visdf * tem0d  <span class="comment">! uv/vis diff sw dn</span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;              fluxr(i,26) = fluxr(i,26) + scmpsw(i)%nirbm * tem0d  <span class="comment">! nir beam sw dn</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;              fluxr(i,27) = fluxr(i,27) + scmpsw(i)%nirdf * tem0d  <span class="comment">! nir diff sw dn</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;<span class="comment">!  ---                                  sw clear-sky fluxes</span></div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;<span class="comment">!                                       -------------------</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;              fluxr(i,29) = fluxr(i,29) + topfsw(i)%upfx0 * tem0d  <span class="comment">! clear sky top sw up</span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;              fluxr(i,31) = fluxr(i,31) + sfcfsw(i)%upfx0 * tem0d  <span class="comment">! clear sky sfc sw up</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;              fluxr(i,32) = fluxr(i,32) + sfcfsw(i)%dnfx0 * tem0d  <span class="comment">! clear sky sfc sw dn</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;<span class="keywordflow">            endif</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;<span class="comment">!  ---  save total and boundary layer clouds</span></div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;        <span class="keywordflow">if</span> (lsswr .or. lslwr) <span class="keywordflow">then</span></div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;          <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;            fluxr(i,17) = fluxr(i,17) + raddt * cldsa(i,4)</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;            fluxr(i,18) = fluxr(i,18) + raddt * cldsa(i,5)</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;<span class="comment">!  ---  save cld frac,toplyr,botlyr and top temp, note that the order</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;<span class="comment">!       of h,m,l cloud is reversed for the fluxr output.</span></div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="comment">!  ---  save interface pressure (pa) of top/bot</span></div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;</div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;          <span class="keywordflow">do</span> j = 1, 3</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;            <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;              tem0d = raddt * cldsa(i,j)</div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;              itop  = mtopa(i,j) - kd</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;              ibtc  = mbota(i,j) - kd</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;              fluxr(i, 8-j) = fluxr(i, 8-j) + tem0d</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;              fluxr(i,11-j) = fluxr(i,11-j) + tem0d * prsi(i,itop+kt)</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;              fluxr(i,14-j) = fluxr(i,14-j) + tem0d * prsi(i,ibtc+kb)</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;              fluxr(i,17-j) = fluxr(i,17-j) + tem0d * tgrs(i,itop)</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;</div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;        <span class="keywordflow">if</span> (.not. shoc_cld) <span class="keywordflow">then</span></div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;          <span class="keywordflow">do</span> k = 1, lm</div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;            k1 = k + kd</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;            <span class="keywordflow">do</span> i = 1, im</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;              cldcov(i,k) = clouds(i,k1,1)</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;<span class="keywordflow">            enddo</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="keywordflow">          enddo</span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;<span class="keywordflow">        endif</span></div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;<span class="comment">!  ---  save optional vertically integrated aerosol optical depth at</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;<span class="comment">!       wavelenth of 550nm aerodp(:,1), and other optional aod for</span></div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;<span class="comment">!       individual species aerodp(:,2:NSPC1)</span></div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;<span class="comment">!       if ( laswflg ) then</span></div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;<span class="comment">!         if ( NFXR &gt; 33 ) then</span></div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;<span class="comment">!           do i = 1, IM</span></div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;<span class="comment">!             fluxr(i,34) = fluxr(i,34) + dtsw*aerodp(i,1)  ! total aod at 550nm (all species)</span></div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;<span class="comment">!           enddo</span></div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;<span class="comment">!           if ( lspcodp ) then</span></div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;<span class="comment">!             do j = 2, NSPC1</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;<span class="comment">!               k = 33 + j</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;<span class="comment">!               do i = 1, IM</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;<span class="comment">!                 fluxr(i,k) = fluxr(i,k) + dtsw*aerodp(i,j) ! aod at 550nm for indiv species</span></div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;<span class="comment">!               enddo</span></div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;<span class="comment">!             enddo</span></div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<span class="comment">!           endif     ! end_if_lspcodp</span></div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;<span class="comment">!         else</span></div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="comment">!           print *,&#39;  !Error! Need to increase array fluxr size NFXR &#39;,&amp;</span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;<span class="comment">!    &amp;              &#39; to be able to output aerosol optical depth&#39;</span></div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="comment">!           stop</span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;<span class="comment">!         endif     ! end_if_nfxr</span></div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;<span class="comment">!       endif       ! end_if_laswflg</span></div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;<span class="keywordflow">      endif</span>                                <span class="comment">! end_if_lssav</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;      <span class="keywordflow">return</span></div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;<span class="comment">!...................................</span></div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;<span class="keyword">      end subroutine </span><a class="code" href="namespacemodule__radiation__driver.html#a8285cf6a4d2e1ed25b0afff8e269ec63">grrad</a></div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;<span class="comment">!-----------------------------------</span></div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;</div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;<span class="comment">!........................................!</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;<span class="keyword">      end module </span><a class="code" href="namespacemodule__radiation__driver.html">module_radiation_driver</a> <span class="comment">!</span></div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="comment">!========================================!</span></div><div class="ttc" id="namespacemodule__radiation__clouds_html_ab45374e1eeec7d6211284b38c3ec8448"><div class="ttname"><a href="namespacemodule__radiation__clouds.html#ab45374e1eeec7d6211284b38c3ec8448">module_radiation_clouds::progcld1</a></div><div class="ttdeci">subroutine, public progcld1                                                                                          </div><div class="ttdoc">This subroutine computes cloud related quantities using zhao/moorthi&amp;#39;s prognostic cloud microphysics ...</div><div class="ttdef"><b>Definition:</b> <a href="radiation__clouds_8f_source.html#l00384">radiation_clouds.f:384</a></div></div>
<div class="ttc" id="namespacephysparam_html_aeaf899d0cbd4248ad4b7f855cb4626e1"><div class="ttname"><a href="namespacephysparam.html#aeaf899d0cbd4248ad4b7f855cb4626e1">physparam::ialbflg</a></div><div class="ttdeci">integer, save ialbflg</div><div class="ttdoc">surface albedo scheme control flag </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00213">physparam.f:213</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_afdc2a7e1dbfb075ac33a2388564d9428"><div class="ttname"><a href="namespacemodule__radiation__driver.html#afdc2a7e1dbfb075ac33a2388564d9428">module_radiation_driver::qmin</a></div><div class="ttdeci">real(kind=kind_phys) qmin</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00225">grrad.f:225</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_a4d755de48d0aa83f337a2a907ac7d8a2"><div class="ttname"><a href="namespacemodule__radiation__driver.html#a4d755de48d0aa83f337a2a907ac7d8a2">module_radiation_driver::iyear0</a></div><div class="ttdeci">integer iyear0</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00235">grrad.f:235</a></div></div>
<div class="ttc" id="namespacemodule__radiation__gases_html_a1def261c0ef5d5408658c87b6dc08b53"><div class="ttname"><a href="namespacemodule__radiation__gases.html#a1def261c0ef5d5408658c87b6dc08b53">module_radiation_gases::gas_init</a></div><div class="ttdeci">subroutine, public gas_init                                                                                          </div><div class="ttdoc">This subroutine sets up ozone, co2, etc. parameters. if climatology ozone then read in monthly ozone ...</div><div class="ttdef"><b>Definition:</b> <a href="radiation__gases_8f_source.html#l00217">radiation_gases.f:217</a></div></div>
<div class="ttc" id="namespacemodule__radsw__main_html_ad9b28f997232642658b4d15a7eb70fcd"><div class="ttname"><a href="namespacemodule__radsw__main.html#ad9b28f997232642658b4d15a7eb70fcd">module_radsw_main::swrad</a></div><div class="ttdeci">subroutine, public swrad                                                                                                </div><div class="ttdoc">This subroutine is the main sw radiation routine. </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l00440">radsw_main.f:440</a></div></div>
<div class="ttc" id="namespacephysparam_html_a90d63a1a0c04479f586ce21df72d36b7"><div class="ttname"><a href="namespacephysparam.html#a90d63a1a0c04479f586ce21df72d36b7">physparam::ioznflg</a></div><div class="ttdeci">integer, save ioznflg</div><div class="ttdoc">ozone dta source control flag </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00175">physparam.f:175</a></div></div>
<div class="ttc" id="namespacephysparam_html_a2b30f07ca3fb04fbfff8c01eb8082e8d"><div class="ttname"><a href="namespacephysparam.html#a2b30f07ca3fb04fbfff8c01eb8082e8d">physparam::iaerflg</a></div><div class="ttdeci">integer, save iaerflg</div><div class="ttdoc">aerosol effect control flag </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00155">physparam.f:155</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_af6e0e1ef2ebb78f57c897ebaf633edd2"><div class="ttname"><a href="namespacemodule__radiation__driver.html#af6e0e1ef2ebb78f57c897ebaf633edd2">module_radiation_driver::loz1st</a></div><div class="ttdeci">logical loz1st</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00236">grrad.f:236</a></div></div>
<div class="ttc" id="namespacemodule__radsw__parameters_html_structmodule__radsw__parameters_1_1cmpfsw__type"><div class="ttname"><a href="namespacemodule__radsw__parameters.html#structmodule__radsw__parameters_1_1cmpfsw__type">module_radsw_parameters::cmpfsw_type</a></div><div class="ttdoc">define type construct for optional component downward fluxes at surface </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00110">radsw_param.f:110</a></div></div>
<div class="ttc" id="namespacephysparam_html_a2ec924900b312f94874ffb0f67d09dd9"><div class="ttname"><a href="namespacephysparam.html#a2ec924900b312f94874ffb0f67d09dd9">physparam::isubcsw</a></div><div class="ttdeci">integer, save isubcsw</div><div class="ttdoc">sub-column cloud approx flag in sw radiation </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00226">physparam.f:226</a></div></div>
<div class="ttc" id="namespacephysparam_html_ac0ecfb79a533c6acab25971a3d871ea2"><div class="ttname"><a href="namespacephysparam.html#ac0ecfb79a533c6acab25971a3d871ea2">physparam::iemsflg</a></div><div class="ttdeci">integer, save iemsflg</div><div class="ttdoc">surface emissivity scheme control flag </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00215">physparam.f:215</a></div></div>
<div class="ttc" id="namespacemodule__radiation__astronomy_html_a8ce5ecf0524d0460baf6c467b532085c"><div class="ttname"><a href="namespacemodule__radiation__astronomy.html#a8ce5ecf0524d0460baf6c467b532085c">module_radiation_astronomy::coszmn</a></div><div class="ttdeci">subroutine, public coszmn                                                                                              </div><div class="ttdoc">This subroutine computes mean cos solar zenith angle over SW calling interval. </div><div class="ttdef"><b>Definition:</b> <a href="radiation__astronomy_8f_source.html#l00788">radiation_astronomy.f:788</a></div></div>
<div class="ttc" id="namespacemodule__radiation__astronomy_html_a7c3585f7355925b360f5bc5d2c25c09e"><div class="ttname"><a href="namespacemodule__radiation__astronomy.html#a7c3585f7355925b360f5bc5d2c25c09e">module_radiation_astronomy::sol_update</a></div><div class="ttdeci">subroutine, public sol_update                                                                                      </div><div class="ttdoc">This subroutine computes solar parameters at forecast time. </div><div class="ttdef"><b>Definition:</b> <a href="radiation__astronomy_8f_source.html#l00310">radiation_astronomy.f:310</a></div></div>
<div class="ttc" id="namespacemodule__radlw__parameters_html_structmodule__radlw__parameters_1_1proflw__type"><div class="ttname"><a href="namespacemodule__radlw__parameters.html#structmodule__radlw__parameters_1_1proflw__type">module_radlw_parameters::proflw_type</a></div><div class="ttdoc">define type construct for optional radiation flux profiles </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00094">radlw_param.f:94</a></div></div>
<div class="ttc" id="namespacemodule__radsw__parameters_html_structmodule__radsw__parameters_1_1topfsw__type"><div class="ttname"><a href="namespacemodule__radsw__parameters.html#structmodule__radsw__parameters_1_1topfsw__type">module_radsw_parameters::topfsw_type</a></div><div class="ttdoc">define type construct for radiation fluxes at toa </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00070">radsw_param.f:70</a></div></div>
<div class="ttc" id="namespacemodule__radiation__gases_html_affc350828412da77ff3cf3e617ddc66c"><div class="ttname"><a href="namespacemodule__radiation__gases.html#affc350828412da77ff3cf3e617ddc66c">module_radiation_gases::nf_vgas</a></div><div class="ttdeci">integer, parameter, public nf_vgas</div><div class="ttdoc">number of gas species </div><div class="ttdef"><b>Definition:</b> <a href="radiation__gases_8f_source.html#l00131">radiation_gases.f:131</a></div></div>
<div class="ttc" id="namespacemodule__radiation__clouds_html"><div class="ttname"><a href="namespacemodule__radiation__clouds.html">module_radiation_clouds</a></div><div class="ttdoc">This module computes cloud related quantities for radiation computations. </div><div class="ttdef"><b>Definition:</b> <a href="radiation__clouds_8f_source.html#l00139">radiation_clouds.f:139</a></div></div>
<div class="ttc" id="namespacephysparam_html_a2f0c4c2c8f4a93048ab2b84826498007"><div class="ttname"><a href="namespacephysparam.html#a2f0c4c2c8f4a93048ab2b84826498007">physparam::iovrsw</a></div><div class="ttdeci">integer, save iovrsw</div><div class="ttdoc">cloud overlapping control flag for sw </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00197">physparam.f:197</a></div></div>
<div class="ttc" id="namespacemodule__radiation__gases_html_a064db1c287e8614ae7efd6b4fac91a6b"><div class="ttname"><a href="namespacemodule__radiation__gases.html#a064db1c287e8614ae7efd6b4fac91a6b">module_radiation_gases::gas_update</a></div><div class="ttdeci">subroutine, public gas_update                                                                                      </div><div class="ttdoc">This subroutine reads in 2-d monthly co2 data set for a specified year. data are in a 15 degree lat/l...</div><div class="ttdef"><b>Definition:</b> <a href="radiation__gases_8f_source.html#l00535">radiation_gases.f:535</a></div></div>
<div class="ttc" id="namespacemodule__radiation__surface_html_acb6f94d91110828e4c117e3ba0b279a5"><div class="ttname"><a href="namespacemodule__radiation__surface.html#acb6f94d91110828e4c117e3ba0b279a5">module_radiation_surface::sfc_init</a></div><div class="ttdeci">subroutine, public sfc_init                                                                                          </div><div class="ttdoc">This subroutine is the initialization program for surface radiation related quantities (albedo...</div><div class="ttdef"><b>Definition:</b> <a href="radiation__surface_8f_source.html#l00129">radiation_surface.f:129</a></div></div>
<div class="ttc" id="namespacephyscons_html"><div class="ttname"><a href="namespacephyscons.html">physcons</a></div><div class="ttdoc">This module contains some the most frequently used math and physics constants for gcm models...</div><div class="ttdef"><b>Definition:</b> <a href="physcons_8f_source.html#l00029">physcons.f:29</a></div></div>
<div class="ttc" id="namespacemodule__radsw__parameters_html_structmodule__radsw__parameters_1_1sfcfsw__type"><div class="ttname"><a href="namespacemodule__radsw__parameters.html#structmodule__radsw__parameters_1_1sfcfsw__type">module_radsw_parameters::sfcfsw_type</a></div><div class="ttdoc">define type construct for radiation fluxes at surface </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00082">radsw_param.f:82</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_a47f0e4defe607fbfc751f6c9274f459a"><div class="ttname"><a href="namespacemodule__radiation__driver.html#a47f0e4defe607fbfc751f6c9274f459a">module_radiation_driver::radupdate</a></div><div class="ttdeci">subroutine, public radupdate                                                                                        </div><div class="ttdoc">This subroutine calls many update subroutines to check and update radiation required but time varying...</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00495">grrad.f:495</a></div></div>
<div class="ttc" id="namespacemodule__radlw__parameters_html_a39a115a97296886b2e6e37b220e942c7"><div class="ttname"><a href="namespacemodule__radlw__parameters.html#a39a115a97296886b2e6e37b220e942c7">module_radlw_parameters::nbdlw</a></div><div class="ttdeci">integer, parameter nbdlw</div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00122">radlw_param.f:122</a></div></div>
<div class="ttc" id="namespacemodule__radsw__parameters_html_ab1e121fde29dde00871e4a7d43be1ddb"><div class="ttname"><a href="namespacemodule__radsw__parameters.html#ab1e121fde29dde00871e4a7d43be1ddb">module_radsw_parameters::nbdsw</a></div><div class="ttdeci">integer, parameter nbdsw</div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00144">radsw_param.f:144</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_a8285cf6a4d2e1ed25b0afff8e269ec63"><div class="ttname"><a href="namespacemodule__radiation__driver.html#a8285cf6a4d2e1ed25b0afff8e269ec63">module_radiation_driver::grrad</a></div><div class="ttdeci">subroutine, public grrad                                                                                                </div><div class="ttdoc">This subroutine is the driver of radiation calculation subroutines. It sets up profile variables for ...</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00810">grrad.f:810</a></div></div>
<div class="ttc" id="namespacemodule__radiation__aerosols_html_afba0069cd611248a9595a126a13f5203"><div class="ttname"><a href="namespacemodule__radiation__aerosols.html#afba0069cd611248a9595a126a13f5203">module_radiation_aerosols::nf_aelw</a></div><div class="ttdeci">integer, parameter, public nf_aelw</div><div class="ttdoc">num of output fields for lw rad </div><div class="ttdef"><b>Definition:</b> <a href="radiation__aerosols_8f_source.html#l00147">radiation_aerosols.f:147</a></div></div>
<div class="ttc" id="namespacephysparam_html_a644d850cdfb6dd159e51223f715683f6"><div class="ttname"><a href="namespacephysparam.html#a644d850cdfb6dd159e51223f715683f6">physparam::iovrlw</a></div><div class="ttdeci">integer, save iovrlw</div><div class="ttdoc">cloud overlapping control flag for lw </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00199">physparam.f:199</a></div></div>
<div class="ttc" id="namespacemodule__radiation__gases_html_ad06401a54d361b3dd852d815d1b0f71e"><div class="ttname"><a href="namespacemodule__radiation__gases.html#ad06401a54d361b3dd852d815d1b0f71e">module_radiation_gases::getgases</a></div><div class="ttdeci">subroutine, public getgases                                                                                          </div><div class="ttdoc">This subroutine sets up global distribution of radiation absorbing gases in volume mixing ratio...</div><div class="ttdef"><b>Definition:</b> <a href="radiation__gases_8f_source.html#l00933">radiation_gases.f:933</a></div></div>
<div class="ttc" id="namespacephysparam_html"><div class="ttname"><a href="namespacephysparam.html">physparam</a></div><div class="ttdoc">This module defines commonly used control variables/parameters in physics related programs...</div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00027">physparam.f:27</a></div></div>
<div class="ttc" id="namespacephysparam_html_adf09a9ec1939f1ee47bb4190a9098941"><div class="ttname"><a href="namespacephysparam.html#adf09a9ec1939f1ee47bb4190a9098941">physparam::isolar</a></div><div class="ttdeci">integer, save isolar</div><div class="ttdoc">solar constant scheme control flag </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00143">physparam.f:143</a></div></div>
<div class="ttc" id="namespacemodule__radsw__parameters_html"><div class="ttname"><a href="namespacemodule__radsw__parameters.html">module_radsw_parameters</a></div><div class="ttdoc">This module contains SW band parameters set up. </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00058">radsw_param.f:58</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_a70a36595385cf1f5794f9c5859e52ab6"><div class="ttname"><a href="namespacemodule__radiation__driver.html#a70a36595385cf1f5794f9c5859e52ab6">module_radiation_driver::vtagrad</a></div><div class="ttdeci">character(40), parameter vtagrad</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00219">grrad.f:219</a></div></div>
<div class="ttc" id="namespacephysparam_html_a61baf693e83ac6144d86fb8213d39a79"><div class="ttname"><a href="namespacephysparam.html#a61baf693e83ac6144d86fb8213d39a79">physparam::ico2flg</a></div><div class="ttdeci">integer, save ico2flg</div><div class="ttdoc">co2 data source control flag </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00171">physparam.f:171</a></div></div>
<div class="ttc" id="namespacephysparam_html_a9555bc46102e3c368ca1f15c73b0692e"><div class="ttname"><a href="namespacephysparam.html#a9555bc46102e3c368ca1f15c73b0692e">physparam::isubclw</a></div><div class="ttdeci">integer, save isubclw</div><div class="ttdoc">sub-column cloud approx flag in lw radiation </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00228">physparam.f:228</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_ab671cb80142c71dab5f41f01ccdcc088"><div class="ttname"><a href="namespacemodule__radiation__driver.html#ab671cb80142c71dab5f41f01ccdcc088">module_radiation_driver::qme5</a></div><div class="ttdeci">real(kind=kind_phys) qme5</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00225">grrad.f:225</a></div></div>
<div class="ttc" id="namespacephysparam_html_af259ebea0c378b3b07343141977db03e"><div class="ttname"><a href="namespacephysparam.html#af259ebea0c378b3b07343141977db03e">physparam::icmphys</a></div><div class="ttdeci">integer, save icmphys</div><div class="ttdoc">cloud microphysics scheme control flag </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00195">physparam.f:195</a></div></div>
<div class="ttc" id="namespacephysparam_html_acb52e2553c9e106bd8885fd09c6e2dd2"><div class="ttname"><a href="namespacephysparam.html#acb52e2553c9e106bd8885fd09c6e2dd2">physparam::lnoprec</a></div><div class="ttdeci">logical, save lnoprec</div><div class="ttdoc">precip effect on radiation flag (ferrier microphysics) </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00205">physparam.f:205</a></div></div>
<div class="ttc" id="namespacemodule__radiation__aerosols_html"><div class="ttname"><a href="namespacemodule__radiation__aerosols.html">module_radiation_aerosols</a></div><div class="ttdoc">This module contains climatological atmospheric aerosol schemes for radiation computations. </div><div class="ttdef"><b>Definition:</b> <a href="radiation__aerosols_8f_source.html#l00116">radiation_aerosols.f:116</a></div></div>
<div class="ttc" id="namespacephyscons_html_a72b27573c69ec418b67763d35b3688a1"><div class="ttname"><a href="namespacephyscons.html#a72b27573c69ec418b67763d35b3688a1">physcons::con_rocp</a></div><div class="ttdeci">real(kind=kind_phys), parameter con_rocp</div><div class="ttdef"><b>Definition:</b> <a href="physcons_8f_source.html#l00104">physcons.f:104</a></div></div>
<div class="ttc" id="namespacephysparam_html_a3506e1f83500ea78568ab697f55cadb4"><div class="ttname"><a href="namespacephysparam.html#a3506e1f83500ea78568ab697f55cadb4">physparam::lcrick</a></div><div class="ttdeci">logical, save lcrick</div><div class="ttdoc">eliminating CRICK control flag </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00201">physparam.f:201</a></div></div>
<div class="ttc" id="namespacephysparam_html_a7318a941744b1ec62dc9a6ff5bfbb50d"><div class="ttname"><a href="namespacephysparam.html#a7318a941744b1ec62dc9a6ff5bfbb50d">physparam::ivflip</a></div><div class="ttdeci">integer, save ivflip</div><div class="ttdoc">vertical profile indexing flag </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00224">physparam.f:224</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_a0b0bf0fa8723b80d0891ec3327d187d7"><div class="ttname"><a href="namespacemodule__radiation__driver.html#a0b0bf0fa8723b80d0891ec3327d187d7">module_radiation_driver::epsq</a></div><div class="ttdeci">real(kind=kind_phys) epsq</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00225">grrad.f:225</a></div></div>
<div class="ttc" id="namespacemodule__radsw__parameters_html_structmodule__radsw__parameters_1_1profsw__type"><div class="ttname"><a href="namespacemodule__radsw__parameters.html#structmodule__radsw__parameters_1_1profsw__type">module_radsw_parameters::profsw_type</a></div><div class="ttdoc">define type construct for optional radiation flux profiles </div><div class="ttdef"><b>Definition:</b> <a href="radsw__param_8f_source.html#l00096">radsw_param.f:96</a></div></div>
<div class="ttc" id="namespacemodule__radlw__parameters_html_structmodule__radlw__parameters_1_1sfcflw__type"><div class="ttname"><a href="namespacemodule__radlw__parameters.html#structmodule__radlw__parameters_1_1sfcflw__type">module_radlw_parameters::sfcflw_type</a></div><div class="ttdoc">define type construct for radiation fluxes at surface </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00080">radlw_param.f:80</a></div></div>
<div class="ttc" id="namespacemodule__radiation__astronomy_html_a00825c1a13e09455c478efa11314cb2d"><div class="ttname"><a href="namespacemodule__radiation__astronomy.html#a00825c1a13e09455c478efa11314cb2d">module_radiation_astronomy::sol_init</a></div><div class="ttdeci">subroutine, public sol_init                                                                                          </div><div class="ttdoc">This subroutine initializes astronomy process, and set up module constants. </div><div class="ttdef"><b>Definition:</b> <a href="radiation__astronomy_8f_source.html#l00139">radiation_astronomy.f:139</a></div></div>
<div class="ttc" id="namespacemodule__radiation__astronomy_html"><div class="ttname"><a href="namespacemodule__radiation__astronomy.html">module_radiation_astronomy</a></div><div class="ttdoc">This module sets up astronomy quantities for solar radiation calculations. </div><div class="ttdef"><b>Definition:</b> <a href="radiation__astronomy_8f_source.html#l00075">radiation_astronomy.f:75</a></div></div>
<div class="ttc" id="namespacemodule__radiation__surface_html_a0fdd0e9a9c536d3d41bd6b6c9d0a8675"><div class="ttname"><a href="namespacemodule__radiation__surface.html#a0fdd0e9a9c536d3d41bd6b6c9d0a8675">module_radiation_surface::setemis</a></div><div class="ttdeci">subroutine, public setemis                                                                                            </div><div class="ttdoc">This subroutine computes surface emissivity for LW radiation. </div><div class="ttdef"><b>Definition:</b> <a href="radiation__surface_8f_source.html#l00643">radiation_surface.f:643</a></div></div>
<div class="ttc" id="namespacemodule__radsw__main_html_afab73c508f778203d0f4b5181f1cbca9"><div class="ttname"><a href="namespacemodule__radsw__main.html#afab73c508f778203d0f4b5181f1cbca9">module_radsw_main::rswinit</a></div><div class="ttdeci">subroutine, public rswinit                                                                                            </div><div class="ttdoc">This subroutine initializes non-varying module variables, conversion factors, and look-up tables...</div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l01269">radsw_main.f:1269</a></div></div>
<div class="ttc" id="namespacemodule__radiation__aerosols_html_a6086afe5183a09ca64810af7fe2a12ac"><div class="ttname"><a href="namespacemodule__radiation__aerosols.html#a6086afe5183a09ca64810af7fe2a12ac">module_radiation_aerosols::aer_init</a></div><div class="ttdeci">subroutine, public aer_init                                                                                          </div><div class="ttdoc">The initialization program to set up necessary parameters and working arrays. </div><div class="ttdef"><b>Definition:</b> <a href="radiation__aerosols_8f_source.html#l00565">radiation_aerosols.f:565</a></div></div>
<div class="ttc" id="namespacemodule__radlw__parameters_html"><div class="ttname"><a href="namespacemodule__radlw__parameters.html">module_radlw_parameters</a></div><div class="ttdoc">This module contains LW band parameters set up. </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00058">radlw_param.f:58</a></div></div>
<div class="ttc" id="namespacemodule__radlw__main_html"><div class="ttname"><a href="namespacemodule__radlw__main.html">module_radlw_main</a></div><div class="ttdoc">This module includes ncep&amp;#39;s modifications of the rrtm-lw radiation ! code from aer inc...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l00236">radlw_main.f:236</a></div></div>
<div class="ttc" id="namespacemodule__radiation__surface_html_a79d2feaf2f32435b179ef7bc86ad3f36"><div class="ttname"><a href="namespacemodule__radiation__surface.html#a79d2feaf2f32435b179ef7bc86ad3f36">module_radiation_surface::setalb</a></div><div class="ttdeci">subroutine, public setalb                                                                                              </div><div class="ttdoc">This subroutine computes four components of surface albedos (i.e., vis-nir, direct-diffused) accordin...</div><div class="ttdef"><b>Definition:</b> <a href="radiation__surface_8f_source.html#l00303">radiation_surface.f:303</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_ad27b36d0186c8147fe839eb5c268d157"><div class="ttname"><a href="namespacemodule__radiation__driver.html#ad27b36d0186c8147fe839eb5c268d157">module_radiation_driver::lextop</a></div><div class="ttdeci">logical, parameter lextop</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00241">grrad.f:241</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_ac4baf8ff048aaa5b85d03cc42c579c7b"><div class="ttname"><a href="namespacemodule__radiation__driver.html#ac4baf8ff048aaa5b85d03cc42c579c7b">module_radiation_driver::monthd</a></div><div class="ttdeci">integer monthd</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00235">grrad.f:235</a></div></div>
<div class="ttc" id="namespacemodule__radsw__main_html"><div class="ttname"><a href="namespacemodule__radsw__main.html">module_radsw_main</a></div><div class="ttdoc">This module includes ncep&amp;#39;s modifications of the rrtm-sw radiation code from aer inc. </div><div class="ttdef"><b>Definition:</b> <a href="radsw__main_8f_source.html#l00260">radsw_main.f:260</a></div></div>
<div class="ttc" id="namespacemodule__radiation__surface_html_ab7800982c900bd632ca74d5e7d2b5ab3"><div class="ttname"><a href="namespacemodule__radiation__surface.html#ab7800982c900bd632ca74d5e7d2b5ab3">module_radiation_surface::nf_albd</a></div><div class="ttdeci">integer, parameter, public nf_albd</div><div class="ttdoc">num of sfc albedo components </div><div class="ttdef"><b>Definition:</b> <a href="radiation__surface_8f_source.html#l00094">radiation_surface.f:94</a></div></div>
<div class="ttc" id="namespacemodule__radlw__main_html_a072a355f2067d729d64d2997270e36b1"><div class="ttname"><a href="namespacemodule__radlw__main.html#a072a355f2067d729d64d2997270e36b1">module_radlw_main::lwrad</a></div><div class="ttdeci">subroutine, public lwrad                                                                                                </div><div class="ttdoc">This subroutine is the main lw radiation routine. </div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l00415">radlw_main.f:415</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_a6eb268f296c77047f389ed6fac5f95be"><div class="ttname"><a href="namespacemodule__radiation__driver.html#a6eb268f296c77047f389ed6fac5f95be">module_radiation_driver::month0</a></div><div class="ttdeci">integer month0</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00235">grrad.f:235</a></div></div>
<div class="ttc" id="namespacephysparam_html_abd79346fa2177075241fe6c5bc77004d"><div class="ttname"><a href="namespacephysparam.html#abd79346fa2177075241fe6c5bc77004d">physparam::lsashal</a></div><div class="ttdeci">logical, save lsashal</div><div class="ttdoc">shallow convection flag </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00207">physparam.f:207</a></div></div>
<div class="ttc" id="namespacemodule__radlw__parameters_html_structmodule__radlw__parameters_1_1topflw__type"><div class="ttname"><a href="namespacemodule__radlw__parameters.html#structmodule__radlw__parameters_1_1topflw__type">module_radlw_parameters::topflw_type</a></div><div class="ttdoc">define type construct for radiation fluxes at toa </div><div class="ttdef"><b>Definition:</b> <a href="radlw__param_8f_source.html#l00070">radlw_param.f:70</a></div></div>
<div class="ttc" id="namespacemodule__radiation__clouds_html_a66cf0f94619a3d865b0c593197a30576"><div class="ttname"><a href="namespacemodule__radiation__clouds.html#a66cf0f94619a3d865b0c593197a30576">module_radiation_clouds::nf_clds</a></div><div class="ttdeci">integer, parameter, public nf_clds</div><div class="ttdoc">number of fields in cloud array </div><div class="ttdef"><b>Definition:</b> <a href="radiation__clouds_8f_source.html#l00164">radiation_clouds.f:164</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_a4916e37c472b2f824b6f566ff67200cd"><div class="ttname"><a href="namespacemodule__radiation__driver.html#a4916e37c472b2f824b6f566ff67200cd">module_radiation_driver::qme6</a></div><div class="ttdeci">real(kind=kind_phys) qme6</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00225">grrad.f:225</a></div></div>
<div class="ttc" id="namespacemodule__radiation__gases_html_af4be311f1ec1601a167655c1632d66de"><div class="ttname"><a href="namespacemodule__radiation__gases.html#af4be311f1ec1601a167655c1632d66de">module_radiation_gases::getozn</a></div><div class="ttdeci">subroutine, public getozn                                                                                              </div><div class="ttdoc">This subroutine sets up climatological ozone profile for radiation calculation this code is originall...</div><div class="ttdef"><b>Definition:</b> <a href="radiation__gases_8f_source.html#l01086">radiation_gases.f:1086</a></div></div>
<div class="ttc" id="namespacemodule__radiation__aerosols_html_ae0d9615fa694e2a5dfe8fb48e99b7e76"><div class="ttname"><a href="namespacemodule__radiation__aerosols.html#ae0d9615fa694e2a5dfe8fb48e99b7e76">module_radiation_aerosols::nf_aesw</a></div><div class="ttdeci">integer, parameter, public nf_aesw</div><div class="ttdoc">num of output fields for sw rad </div><div class="ttdef"><b>Definition:</b> <a href="radiation__aerosols_8f_source.html#l00145">radiation_aerosols.f:145</a></div></div>
<div class="ttc" id="namespacemodule__radiation__clouds_html_ab6fef8945e0a409b2e0968b414ba5573"><div class="ttname"><a href="namespacemodule__radiation__clouds.html#ab6fef8945e0a409b2e0968b414ba5573">module_radiation_clouds::cld_init</a></div><div class="ttdeci">subroutine, public cld_init                                                                                          </div><div class="ttdoc">This subroutine is an initialization program for cloud-radiation calculations. It sets up boundary la...</div><div class="ttdef"><b>Definition:</b> <a href="radiation__clouds_8f_source.html#l00231">radiation_clouds.f:231</a></div></div>
<div class="ttc" id="namespacemodule__radiation__gases_html"><div class="ttname"><a href="namespacemodule__radiation__gases.html">module_radiation_gases</a></div><div class="ttdoc">This module sets up ozone climatological profiles and other constant gas profiles, such as co2, ch4, n2o, o2, and those of cfc gases. All data are entered as mixing ratio by volume, except ozone which is mass mixing ratio (g/g). </div><div class="ttdef"><b>Definition:</b> <a href="radiation__gases_8f_source.html#l00106">radiation_gases.f:106</a></div></div>
<div class="ttc" id="namespacemodule__radiation__clouds_html_ab477be986b08fe827c44dbe352a23d39"><div class="ttname"><a href="namespacemodule__radiation__clouds.html#ab477be986b08fe827c44dbe352a23d39">module_radiation_clouds::diagcld1</a></div><div class="ttdeci">subroutine, public diagcld1</div><div class="ttdoc">This subroutine computes cloud fractions for radiation calculations. </div><div class="ttdef"><b>Definition:</b> <a href="radiation__clouds_8f_source.html#l01789">radiation_clouds.f:1789</a></div></div>
<div class="ttc" id="namespacephyscons_html_ad200a2d8149c61dbdd05124ce977a928"><div class="ttname"><a href="namespacephyscons.html#ad200a2d8149c61dbdd05124ce977a928">physcons::con_fvirt</a></div><div class="ttdeci">real(kind=kind_phys), parameter con_fvirt</div><div class="ttdef"><b>Definition:</b> <a href="physcons_8f_source.html#l00107">physcons.f:107</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_af039e0c23dc6ab8d2f8b1c1c796ac0da"><div class="ttname"><a href="namespacemodule__radiation__driver.html#af039e0c23dc6ab8d2f8b1c1c796ac0da">module_radiation_driver::radinit</a></div><div class="ttdeci">subroutine, public radinit                                                                                            </div><div class="ttdoc">This subroutine is the initialization of radiation calculations. </div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00261">grrad.f:261</a></div></div>
<div class="ttc" id="namespacemodule__radiation__clouds_html_a2f45f48505bb69a968c788ff680b5642"><div class="ttname"><a href="namespacemodule__radiation__clouds.html#a2f45f48505bb69a968c788ff680b5642">module_radiation_clouds::progcld2</a></div><div class="ttdeci">subroutine, public progcld2                                                                                          </div><div class="ttdoc">This subroutine computes cloud related quantities using ferrier&amp;#39;s prognostic cloud microphysics schem...</div><div class="ttdef"><b>Definition:</b> <a href="radiation__clouds_8f_source.html#l00844">radiation_clouds.f:844</a></div></div>
<div class="ttc" id="namespacemodule__radiation__clouds_html_a1953118ed22c3b6f8d94ef231b47a08b"><div class="ttname"><a href="namespacemodule__radiation__clouds.html#a1953118ed22c3b6f8d94ef231b47a08b">module_radiation_clouds::progcld3</a></div><div class="ttdeci">subroutine, public progcld3                                                                                          </div><div class="ttdoc">This subroutine computes cloud related quantities using zhao/moorthi&amp;#39;s prognostic cloud microphysics ...</div><div class="ttdef"><b>Definition:</b> <a href="radiation__clouds_8f_source.html#l01357">radiation_clouds.f:1357</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_a9ee6a89464bf206cc07ea30d7eeaaeb8"><div class="ttname"><a href="namespacemodule__radiation__driver.html#a9ee6a89464bf206cc07ea30d7eeaaeb8">module_radiation_driver::itsfc</a></div><div class="ttdeci">integer itsfc</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00232">grrad.f:232</a></div></div>
<div class="ttc" id="namespacemodule__radlw__main_html_ad1f036ae760a7e9dcbbdd93492617bb3"><div class="ttname"><a href="namespacemodule__radlw__main.html#ad1f036ae760a7e9dcbbdd93492617bb3">module_radlw_main::rlwinit</a></div><div class="ttdeci">subroutine, public rlwinit                                                                                            </div><div class="ttdoc">This subroutine performs calculations necessary for the initialization of the longwave model...</div><div class="ttdef"><b>Definition:</b> <a href="radlw__main_8f_source.html#l01249">radlw_main.f:1249</a></div></div>
<div class="ttc" id="namespacephyscons_html_a2ca326d6f385fb0100c05ed44b20c345"><div class="ttname"><a href="namespacephyscons.html#a2ca326d6f385fb0100c05ed44b20c345">physcons::con_epsm1</a></div><div class="ttdeci">real(kind=kind_phys), parameter con_epsm1</div><div class="ttdef"><b>Definition:</b> <a href="physcons_8f_source.html#l00109">physcons.f:109</a></div></div>
<div class="ttc" id="namespacemodule__radiation__aerosols_html_a476c0181513603112dec3f4d2a2ec839"><div class="ttname"><a href="namespacemodule__radiation__aerosols.html#a476c0181513603112dec3f4d2a2ec839">module_radiation_aerosols::nspc1</a></div><div class="ttdeci">integer, parameter, public nspc1</div><div class="ttdoc">total+species </div><div class="ttdef"><b>Definition:</b> <a href="radiation__aerosols_8f_source.html#l00153">radiation_aerosols.f:153</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_aab2535e9906afd709124056f4ca1e470"><div class="ttname"><a href="namespacemodule__radiation__driver.html#aab2535e9906afd709124056f4ca1e470">module_radiation_driver::ltp</a></div><div class="ttdeci">integer, parameter ltp</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00239">grrad.f:239</a></div></div>
<div class="ttc" id="namespacephyscons_html_a25c0b5ef7ed84a574bf7e215ddaee65d"><div class="ttname"><a href="namespacephyscons.html#a25c0b5ef7ed84a574bf7e215ddaee65d">physcons::con_eps</a></div><div class="ttdeci">real(kind=kind_phys), parameter con_eps</div><div class="ttdef"><b>Definition:</b> <a href="physcons_8f_source.html#l00108">physcons.f:108</a></div></div>
<div class="ttc" id="namespacemodule__radiation__surface_html"><div class="ttname"><a href="namespacemodule__radiation__surface.html">module_radiation_surface</a></div><div class="ttdoc">This module sets up surface albedo for sw radiation and surface emissivity for lw radiation...</div><div class="ttdef"><b>Definition:</b> <a href="radiation__surface_8f_source.html#l00075">radiation_surface.f:75</a></div></div>
<div class="ttc" id="namespacephysparam_html_ae5b7bb287e8a1f935cf135ffeaadca7a"><div class="ttname"><a href="namespacephysparam.html#ae5b7bb287e8a1f935cf135ffeaadca7a">physparam::lcnorm</a></div><div class="ttdeci">logical, save lcnorm</div><div class="ttdoc">in-cld condensate control flag </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00203">physparam.f:203</a></div></div>
<div class="ttc" id="namespacephysparam_html_a4eef5ac5e5b83526d5da7de493cfe73d"><div class="ttname"><a href="namespacephysparam.html#a4eef5ac5e5b83526d5da7de493cfe73d">physparam::ictmflg</a></div><div class="ttdeci">integer, save ictmflg</div><div class="ttdoc">external data time/date control flag </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00173">physparam.f:173</a></div></div>
<div class="ttc" id="namespacemodule__radiation__aerosols_html_a94a9a162f822d2ee5c5bff611403dd06"><div class="ttname"><a href="namespacemodule__radiation__aerosols.html#a94a9a162f822d2ee5c5bff611403dd06">module_radiation_aerosols::setaer</a></div><div class="ttdeci">subroutine, public setaer                                                                                              </div><div class="ttdoc">This subroutine computes aerosols optical properties. </div><div class="ttdef"><b>Definition:</b> <a href="radiation__aerosols_8f_source.html#l02019">radiation_aerosols.f:2019</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html_a3fc43ca0d2c5f69a380ddb4f0926ecc7"><div class="ttname"><a href="namespacemodule__radiation__driver.html#a3fc43ca0d2c5f69a380ddb4f0926ecc7">module_radiation_driver::prsmin</a></div><div class="ttdeci">real, parameter prsmin</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00229">grrad.f:229</a></div></div>
<div class="ttc" id="namespacemodule__radiation__driver_html"><div class="ttname"><a href="namespacemodule__radiation__driver.html">module_radiation_driver</a></div><div class="ttdoc">This file is the radiation driver module. it prepares atmospheric profiles and invokes main radiation...</div><div class="ttdef"><b>Definition:</b> <a href="grrad_8f_source.html#l00184">grrad.f:184</a></div></div>
<div class="ttc" id="namespacephysparam_html_aaba5cffa32ce34374f15cb09e21ab973"><div class="ttname"><a href="namespacephysparam.html#aaba5cffa32ce34374f15cb09e21ab973">physparam::icldflg</a></div><div class="ttdeci">integer, save icldflg</div><div class="ttdoc">cloud optical property scheme control flag </div><div class="ttdef"><b>Definition:</b> <a href="physparam_8f_source.html#l00193">physparam.f:193</a></div></div>
<div class="ttc" id="namespacemodule__radiation__aerosols_html_a2a91dba33725576c80b4b0f556031707"><div class="ttname"><a href="namespacemodule__radiation__aerosols.html#a2a91dba33725576c80b4b0f556031707">module_radiation_aerosols::aer_update</a></div><div class="ttdeci">subroutine, public aer_update                                                                                      </div><div class="ttdoc">This subroutine checks and updates time varying climatology aerosol data sets. </div><div class="ttdef"><b>Definition:</b> <a href="radiation__aerosols_8f_source.html#l01648">radiation_aerosols.f:1648</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="grrad_8f.html">grrad.f</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
